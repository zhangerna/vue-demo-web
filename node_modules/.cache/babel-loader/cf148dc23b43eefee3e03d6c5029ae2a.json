{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js!/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/testDrive/carBox.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/testDrive/carBox.vue","mtime":1576031701000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport httpClient from \"@/utils/httpclient\";\nimport { getDateString4 as _getDateString } from \"@/utils/date\";\nexport default {\n  name: \"shopManager\",\n  inject: [\"reload\"],\n  watch: {\n    curImei: function curImei(newV) {\n      if (newV.length == 15) {\n        this.imeiIsVaild = true;\n      } else {\n        this.imeiIsVaild = false;\n      }\n    }\n  },\n  data: function data() {\n    return {\n      imeiIsVaild: true,\n      showUnpairTip: false,\n      searchText: '',\n      unpairText: this.$t('m.car_box.unpair_tip_content'),\n      deleteText: this.$t('m.car_box.del_tip_content'),\n      showDelTip: false,\n      tableFields: {\n        super_number: {\n          label: this.$t('m.common.super_number'),\n          class: \"text-center\"\n        },\n        imei: {\n          label: this.$t('m.common.imei'),\n          class: \"text-center\"\n        },\n        type: {\n          label: this.$t('m.cloud.device_type'),\n          class: \"text-center\"\n        },\n        vin: {\n          label: this.$t('m.common.vin2'),\n          class: \"text-center\"\n        },\n        updateTime: {\n          label: this.$t('m.cloud.last_update_time'),\n          class: \"text-center\"\n        },\n        actions: {\n          label: this.$t('m.vehicle.actions'),\n          class: \"Actions\"\n        }\n      },\n      curImei: '',\n      table: null,\n      showBindTip: false,\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      totalPages: 0,\n      showTip: false,\n      curName: '',\n      vehicleList: [],\n      vehicleType: '0',\n      curDeviceId: '',\n      curVehicleId: ''\n    };\n  },\n  mounted: function mounted() {\n    this.initData(this.currentPage, this.pageSize);\n    this.installTip();\n  },\n  methods: {\n    checkVehicleStatus: function checkVehicleStatus(id, type, vehicleId) {\n      var _this = this;\n\n      //参数：第一个是deviceid,第二个是点击按钮类型，第三个是vehicleid\n      httpClient.get('/api/v1/clouddrive/vehicle/checkdrivestatus?vehicleId=' + vehicleId).then(function (res) {\n        if (res.data.code === 200 && res.data.data.result) {\n          if (type === 'unpair') {\n            //解绑\n            _this.unpairText = _this.$t('m.car_box.unpair_tip_content');\n            _this.curDeviceId = id;\n            _this.showUnpairTip = true;\n          } else if (type === 'delete') {\n            //删除\n            _this.deleteText = _this.$t('m.car_box.del_tip_content');\n            _this.curDeviceId = id;\n            _this.showDelTip = true;\n          }\n        } else {\n          if (type === 'unpair') {\n            _this.unpairText = _this.$t('m.car_box.unpair_text_warn');\n            _this.curDeviceId = id;\n            _this.showUnpairTip = true;\n          } else if (type === 'delete') {\n            _this.deleteText = _this.$t('m.car_box.delete_text_warn');\n            _this.curDeviceId = id;\n            _this.showDelTip = true;\n          }\n        }\n      });\n    },\n    searchData: function searchData() {\n      this.initData(1);\n    },\n    initData: function initData(page) {\n      var _this2 = this;\n\n      httpClient.get(\"/api/v1/clouddrive/device/box/pagelist?searchtext=\".concat(this.searchText, \"&pageNo=\").concat(page, \"&pageSize=\").concat(this.pageSize)).then(function (response) {\n        if (response.data.code == 200 && response.data.data.datas) {\n          _this2.total = response.data.data.rowCount;\n          _this2.pageCount = response.data.data.totalPages;\n\n          _this2.filterData(response.data.data.datas ? response.data.data.datas : []);\n        }\n      });\n    },\n    installTip: function installTip() {\n      var _this3 = this;\n\n      httpClient.get('/api/v1/clouddrive/vehicle/unbindlist').then(function (res) {\n        if (res.data.code == 200) {\n          _this3.vehicleList = res.data.data;\n        }\n      });\n    },\n    getDateString4: function getDateString4(time) {\n      return _getDateString(time);\n    },\n    bindVehicle: function bindVehicle(imei) {\n      this.curImei = imei;\n      this.showBindTip = true;\n    },\n    unpairVehicle: function unpairVehicle() {\n      var _this4 = this;\n\n      httpClient.post('/api/v1/clouddrive/device/box/unbind', {\n        deviceId: this.curDeviceId\n      }).then(function (res) {\n        if (res.data.code == 200 && res.data.data.result) {\n          _this4.reload();\n        } else {\n          alert(\"解绑失败\");\n        }\n      });\n    },\n    delIdM: function delIdM() {\n      var _this5 = this;\n\n      httpClient.post('/api/v1/clouddrive/device/box/delete', {\n        deviceId: this.curDeviceId\n      }).then(function (res) {\n        if (res.data.code == 200 && res.data.data.result) {\n          _this5.reload();\n        } else {\n          alert(\"删除失败\");\n        }\n      });\n    },\n    filterData: function filterData(data) {\n      var _this6 = this;\n\n      this.table = data.map(function (item) {\n        return {\n          super_number: item.deviceServiceNum,\n          imei: item.deviceImei,\n          vin: item.vin,\n          id: item.vehicleId,\n          deviceType: item.deviceType,\n          deviceId: item.deviceId,\n          make: item.make ? item.make : 'N/A',\n          year: item.year ? item.year : 'N/A',\n          model: item.model ? item.model : 'N/A',\n          updateTime: item.updateTime ? _this6.getDateString4(item.updateTime) : 'N/A'\n        };\n      });\n    },\n    bindDeviceData: function bindDeviceData() {\n      var _this7 = this;\n\n      if (this.vehicleType && this.curImei) {\n        httpClient.post('/api/v1/clouddrive/device/box/bind', {\n          deviceImei: this.curImei,\n          vehicleId: this.vehicleType\n        }).then(function (res) {\n          if (res.data.code == 200 && res.data.data.result) {\n            _this7.reload();\n          } else {\n            alert(res.data.data.content);\n          }\n        });\n      }\n    },\n    prevPage: function prevPage() {\n      this.initData(this.currentPage > 1 ? this.currentPage - 1 : 1);\n    },\n    nextPage: function nextPage() {\n      this.initData(this.currentPage >= this.pageCount ? this.currentPage : this.currentPage + 1);\n    },\n    changePage: function changePage(page) {\n      this.initData(page);\n    }\n  }\n};",{"version":3,"sources":["carBox.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"animated fadeIn shop carbox\">\n        <b-card class=\"custom-header\">\n            <div slot=\"header\">\n                {{ $t('m.dashboard.car_box') }}\n                <div class=\"float-right\">\n                    <button class=\"btn btn-sm btn-primary \" @click=\"showBindTip = true\">\n                        <i class=\"fa fa-wrench\"></i>\n                        {{ $t('m.vehicle.b_install') }}\n                    </button>\n                </div>\n            </div>\n            <b-row>\n                <b-col class=\"col-5\">\n                    <b-form-group class=\"search-data\">\n                        <b-input-group>\n                            <b-form-input type=\"text\" :placeholder=\"$t('m.vehicle.search_mind')\" v-model=\"searchText\"></b-form-input>\n                            <b-input-group-append>\n                                <b-button variant=\"primary\" @click=\"searchData()\"><i class=\"fa fa-search\"></i>{{ $t('m.vehicle.b_search') }}\n                                </b-button>\n                            </b-input-group-append>\n                        </b-input-group>\n                    </b-form-group>\n                </b-col>\n            </b-row>\n\n            <div class=\"content\">\n                <b-table class=\"mb-0 table-outline table-responsive-sm text-center\" small striped responsive=\"sm\" :items=\"table\" hover :fields=\"tableFields\">\n                    <template slot=\"vin\" slot-scope=\"data\">\n                        <span>{{ data.item.year }} {{ data.item.make }} {{ data.item.model }}</span>\n                        <template v-if=\"data.item.vin\">\n                            <p class=\"hot-link\" @click=\"$router.push('/inventory/vehicle/detail/' + data.item.id)\">{{ data.item.vin }}</p>\n                        </template>\n                        <template v-else>\n                            <p>N/A</p>\n                        </template>\n                    </template>\n                    <template slot=\"type\" slot-scope=\"data\">\n                        <template v-if=\"data.item.type == 1\">\n                            {{ $t('m.cloud.device_name_nonda') }}\n                        </template>\n                        <template v-else>\n                            {{ $t('m.cloud.device_name_chelian') }}\n                        </template>\n                    </template>\n                    <template slot=\"actions\" slot-scope=\"data\">\n                        <template v-if=\"data.item.vin && data.item.vin != 'N/A'\">\n                            <div class=\"btn btn-sm btn-primary placeholder\" style=\"margin-right: 4px\" v-b-tooltip.hover :title=\"$t('m.common.b_unpair')\"  @click=\"checkVehicleStatus(data.item.deviceId,'unpair',data.item.vehicleId)\">\n                                <i class=\"fa fa-close\"></i>\n                            </div>\n                        </template>\n                        <template v-else>\n                            <div class=\"btn btn-sm btn-primary placeholder\" style=\"margin-right: 4px\" v-b-tooltip.hover :title=\"$t('m.device.b_install')\" @click=\"bindVehicle(data.item.imei)\">\n                                <i class=\"fa fa-wrench\"></i>\n                            </div>\n                        </template>\n                        <div class=\"btn btn-sm btn-danger btn-del\" @click=\"checkVehicleStatus(data.item.deviceId,'delete',data.item.vehicleId)\" v-b-tooltip.hover :title=\"$t('m.device.b_del')\">\n                            <i class=\"cui cui-trash\" ></i>\n                        </div>\n                    </template>\n                </b-table>\n            </div>\n            <b-row style=\"margin-top: 10px;\">\n                <b-col sm=\"4\" lg=\"4\">\n                    <div class=\"dataTables_info\" id=\"DataTables0\" role=\"status\" aria-live=\"polite\">\n                        {{ $t('m.common.show') }} {{10 * (currentPage - 1) + 1 }} {{ $t('m.common.to') }} {{currentPage === totalPages? total :currentPage * 10 }} {{ $t('m.common.of') }} {{total}} {{ $t('m.common.entries') }}\n                    </div>\n                </b-col>\n                <b-col sm=\"8\" lg=\"8\">\n                    <b-pagination align=\"right\" :total-rows=\"total\" v-model=\"currentPage\" :per-page=\"10\" @input=\" changePage(currentPage)\"></b-pagination>\n                </b-col>\n            </b-row>\n        </b-card>\n        <b-modal ref=\"my-modal\" :title=\"$t('m.cloud.install_box')\" :ok-disabled=\"vehicleType === '0' || curImei.length != 15 \" :ok-title=\"$t('m.device.b_install')\" :cancel-title=\"$t('m.tip.b_cancel')\" v-model=\"showBindTip\" @ok=\"bindDeviceData()\">\n            <p>{{ $t('m.cloud.box_tip1') }}</p>\n            <p>{{ $t('m.cloud.box_tip2') }}</p>\n            <p style=\"color: red;margin-bottom: 2px;\">{{ $t('m.cloud.box_tip3') }}</p>\n            <p style=\"color: red;\">{{ $t('m.tip.check_imei') }}</p>\n            <b-form-group class=\"vehicle-id\">\n                <b-input-group>\n                    <b-input-group-prepend>\n                        <b-input-group-text>{{$t('m.common.imei')}}</b-input-group-text>\n                    </b-input-group-prepend>\n                    <b-form-input v-model=\"curImei\" aria-describedby=\"input-live-help input-live-feedback\" id=\"input-live\" trim=\"trim\"  type=\"number\" :class=\"!imeiIsVaild ? 'is-invalid' : ''\"></b-form-input>\n                    <b-form-invalid-feedback id=\"input-live-feedback\" v-if=\"!imeiIsVaild\">\n                        {{$t('m.car_box.IMEI_verify')}}\n                    </b-form-invalid-feedback>\n                </b-input-group>\n            </b-form-group>\n            <b-form-group>\n                <b-input-group>\n                    <b-input-group-prepend>\n                        <b-input-group-text>{{$t('m.cloud.vehicle_type')}}</b-input-group-text>\n                    </b-input-group-prepend>\n                    <select class=\"form-control\" name=\"\" v-model=\"vehicleType\">\n                        <option selected disabled value=\"0\">{{ $t('m.cloud.vehicle_type_p') }}</option>\n                        <option v-for=\"(item, index) in vehicleList\" :key=\"index\" :value=\"item.vehicleId\">{{item.vehicleYear ? item.vehicleYear : 'N/A' }} {{ item.vehicleMake ? item.vehicleMake : 'N/A' }} {{ item.vehicleModel ? item.vehicleModel : 'N/A' }} {{ item.vehicleAlias ? \"-\" + item.vehicleAlias : 'N/A' }},VIN:{{ item.vin }} </option>\n                    </select>\n                </b-input-group>\n            </b-form-group>\n        </b-modal>\n        <b-modal ref=\"unpair-model\" :title=\"$t('m.common.b_unpair')\" v-model=\"showUnpairTip\" :ok-title=\"$t('m.tip.confirm')\" :cancel-title=\"$t('m.tip.b_cancel')\"  @ok=\"unpairVehicle()\">\n            <p>{{ unpairText }}</p>\n        </b-modal>\n        <b-modal ref=\"del-model\" :title=\"$t('m.device.b_del')\" v-model=\"showDelTip\" :ok-title=\"$t('m.tip.confirm')\" :cancel-title=\"$t('m.tip.b_cancel')\"  @ok=\"delIdM()\">\n            <p>{{ deleteText }}</p>\n        </b-modal>\n    </div>\n</template>\n\n<style lang=\"scss\" scoped>\n    .carbox {\n        .is-invalid {\n            border: 1px solid red;\n        }\n    }\n</style>\n\n<script>\n    import httpClient from \"@/utils/httpclient\";\n    import { getDateString4 } from \"@/utils/date\";\n    export default {\n        name: \"shopManager\",\n        inject: [\"reload\"],\n        watch: {\n            curImei (newV) {\n                if (newV.length == 15) {\n                    this.imeiIsVaild = true;\n                } else {\n                    this.imeiIsVaild = false;\n                }\n            }\n        },\n        data () {\n            return {\n                imeiIsVaild: true,\n                showUnpairTip: false,\n                searchText:'',\n                unpairText:this.$t('m.car_box.unpair_tip_content'),\n                deleteText:this.$t('m.car_box.del_tip_content'),\n                showDelTip: false,\n                tableFields: {\n                    super_number: {\n                        label: this.$t('m.common.super_number'),\n                        class: \"text-center\"\n                    },\n                    imei: {\n                        label: this.$t('m.common.imei'),\n                        class: \"text-center\"\n                    },\n                    type: {\n                        label: this.$t('m.cloud.device_type'),\n                        class: \"text-center\"\n                    },\n                    vin: {\n                        label: this.$t('m.common.vin2'),\n                        class: \"text-center\"\n                    },\n                    updateTime: {\n                        label: this.$t('m.cloud.last_update_time'),\n                        class: \"text-center\"\n                    },\n                    actions: {\n                        label: this.$t('m.vehicle.actions'),\n                        class: \"Actions\"\n                    }\n                },\n                curImei: '',\n                table: null,\n                showBindTip: false,\n                currentPage: 1,\n                pageSize: 10,\n                total: 0,\n                totalPages:0,\n                showTip: false,\n                curName: '',\n                vehicleList: [],\n                vehicleType: '0',\n                curDeviceId: '',\n                curVehicleId: ''\n            }\n        },\n        mounted() {\n            this.initData(this.currentPage, this.pageSize);\n            this.installTip();\n        },\n        methods: {\n            checkVehicleStatus(id,type,vehicleId){//参数：第一个是deviceid,第二个是点击按钮类型，第三个是vehicleid\n                httpClient.get('/api/v1/clouddrive/vehicle/checkdrivestatus?vehicleId='+vehicleId).then(res=>{\n                    if(res.data.code === 200 && res.data.data.result){\n                        if(type === 'unpair'){//解绑\n                            this.unpairText = this.$t('m.car_box.unpair_tip_content');\n                            this.curDeviceId = id;\n                            this.showUnpairTip = true;\n                        }else if(type === 'delete'){//删除\n                            this.deleteText = this.$t('m.car_box.del_tip_content');\n                            this.curDeviceId = id;\n                            this.showDelTip = true;\n                        }\n                    }else{\n                        if(type === 'unpair'){\n                            this.unpairText = this.$t('m.car_box.unpair_text_warn');\n                            this.curDeviceId = id;\n                            this.showUnpairTip = true;\n                        }else if(type === 'delete'){\n                            this.deleteText = this.$t('m.car_box.delete_text_warn');\n                            this.curDeviceId = id;\n                            this.showDelTip = true;\n                        }\n\n                    }\n                })\n            },\n            searchData(){\n                this.initData(1)\n            },\n            initData(page) {\n                httpClient.get(`/api/v1/clouddrive/device/box/pagelist?searchtext=${this.searchText}&pageNo=${page}&pageSize=${this.pageSize}`).then(response => {\n                    if (response.data.code == 200 && response.data.data.datas) {\n                        this.total = response.data.data.rowCount;\n                        this.pageCount = response.data.data.totalPages;\n                        this.filterData(response.data.data.datas ? response.data.data.datas : []);\n                    }\n                })\n            },\n            installTip() {\n                httpClient.get('/api/v1/clouddrive/vehicle/unbindlist').then(res => {\n                    if (res.data.code == 200) {\n                        this.vehicleList = res.data.data;\n                    }\n                });\n            },\n            getDateString4(time) {\n                return getDateString4(time);\n            },\n            bindVehicle(imei){\n                this.curImei = imei;\n                this.showBindTip = true;\n            },\n            unpairVehicle() {\n                httpClient.post('/api/v1/clouddrive/device/box/unbind', {\n                    deviceId: this.curDeviceId\n                }).then(res => {\n                    if (res.data.code == 200 && res.data.data.result) {\n                        this.reload();\n                    } else {\n                        alert(\"解绑失败\");\n                    }\n                });\n            },\n            delIdM() {\n                httpClient.post('/api/v1/clouddrive/device/box/delete', {\n                    deviceId: this.curDeviceId\n                }).then(res => {\n                    if (res.data.code == 200 && res.data.data.result) {\n                        this.reload();\n                    } else {\n                        alert(\"删除失败\");\n                    }\n                });\n            },\n            filterData(data) {\n                this.table = data.map(item => {\n                    return {\n                        super_number: item.deviceServiceNum,\n                        imei: item.deviceImei,\n                        vin: item.vin,\n                        id: item.vehicleId,\n                        deviceType: item.deviceType,\n                        deviceId: item.deviceId,\n                        make: item.make ? item.make : 'N/A',\n                        year: item.year ? item.year : 'N/A',\n                        model: item.model ? item.model : 'N/A',\n                        updateTime: item.updateTime ? this.getDateString4(item.updateTime) : 'N/A'\n                    }\n                });\n            },\n            bindDeviceData() {\n                if (this.vehicleType && this.curImei) {\n                    httpClient.post('/api/v1/clouddrive/device/box/bind', {\n                        deviceImei: this.curImei,\n                        vehicleId: this.vehicleType\n                    }).then(res => {\n                        if (res.data.code == 200 && res.data.data.result) {\n                            this.reload();\n                        } else {\n                            alert(res.data.data.content);\n                        }\n                    });\n                }\n            },\n            prevPage(){\n                this.initData(this.currentPage > 1  ? this.currentPage - 1 : 1)\n            },\n            nextPage(){\n                this.initData(this.currentPage >= this.pageCount  ? this.currentPage : this.currentPage + 1)\n            },\n            changePage(page) {\n                this.initData(page);\n            }\n        }\n    }\n</script>\n"],"sourceRoot":"src/views/dashboard/testDrive"}]}