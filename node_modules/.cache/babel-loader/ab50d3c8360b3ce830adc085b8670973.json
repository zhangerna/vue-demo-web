{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/thread-loader/dist/cjs.js!/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js!/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/bindVehicle.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/bindVehicle.vue","mtime":1569468423000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport httpClient from \"@/utils/httpclient\";\nimport VehicleForm from \"@/components/vehicleForm\";\nimport model from \"@/components/model\";\nexport default {\n  name: \"bindVehicle\",\n  inject: [\"reload\"],\n  components: {\n    VehicleForm: VehicleForm,\n    model: model\n  },\n  data: function data() {\n    return {\n      step1: true,\n      step2: false,\n      step3: false,\n      deviceId: null,\n      step1Button: true,\n      imeiIsVaild: false,\n      imeiSuccess: false,\n      imeiDisable: false,\n      step2Button: true,\n      title: '',\n      data1: {},\n      data2: null,\n      showTip: false,\n      vin: '',\n      vinDisable: false,\n      vinIsVaild: false,\n      vinSuccess: false,\n      isClickStep2: false,\n      vehicleId: '',\n      btnGroup: {\n        btnFirst: 'Cancel',\n        btnSecond: 'OK'\n      },\n      content: '',\n      err: false\n    };\n  },\n  watch: {\n    deviceId: function deviceId(newV) {\n      if (newV.length == 15) {\n        this.deviceId = newV;\n        this.imeiDisable = this.err ? false : true;\n        this.imeiIsVaild = false;\n        this.imeiSuccess = true;\n        this.step1Button = false;\n      } else {\n        this.imeiIsVaild = true;\n      }\n    },\n    vin: function vin(newV) {\n      if (newV.length == 17) {\n        this.vin = newV;\n        this.vinDisable = true;\n        this.vinIsVaild = false;\n        this.vinSuccess = false;\n        this.step2Button = false;\n        this.clickStep2();\n      } else {\n        this.vinDisable = false;\n        this.vinIsVaild = true;\n      }\n    }\n  },\n  mounted: function mounted() {\n    if (this.$route.query.deviceMac) {\n      this.step1 = false;\n      this.step2 = true;\n      this.deviceId = this.$route.query.deviceMac;\n    }\n  },\n  methods: {\n    closeBox: function closeBox(type) {\n      if (type && (this.btnGroup.btnSecond == 'Unpair' || this.btnGroup.btnSecond == '解绑')) {\n        this.unbind(this.data1);\n      }\n\n      if (type && this.btnGroup.status == 'vin') {\n        this.unbind(this.data2);\n      }\n\n      this.showTip = false;\n    },\n    reloadPage: function reloadPage() {\n      window.location.reload();\n    },\n    unbind: function unbind(data) {\n      var _this = this;\n\n      httpClient.post('/api/v1/vehicle/unbind/device', {\n        deviceMac: data.deviceMac,\n        vin: data.vin\n      }).then(function (response) {\n        if (response.data.code == 200) {\n          if (_this.step2) {\n            window.location.reload();\n          }\n\n          _this.vin = '';\n          _this.vinDisable = false;\n          _this.vinIsVaild = false;\n          _this.vinSuccess = false;\n          _this.step2Button = true;\n          _this.showTip = false;\n          _this.step1 = false;\n          _this.step2 = true;\n        } else {\n          window.location.reload();\n        }\n      });\n    },\n    clickStep2: function clickStep2() {\n      var _this2 = this;\n\n      httpClient.get('/api/v1/vehicle/detail/vin?vin=' + this.vin, {}).then(function (response) {\n        _this2.data2 = response.data.data;\n        _this2.data2.mac = _this2.deviceId;\n\n        if (_this2.data2.deviceMac == '') {\n          _this2.isClickStep2 = true;\n          _this2.vinSuccess = false;\n        } else {\n          _this2.title = _this2.$t('m.tip.warn');\n          _this2.content = _this2.$t('m.tip.vehicle_pair_warn', {\n            imei: response.data.data.deviceMac\n          });\n          _this2.btnGroup = {\n            btnFirst: _this2.$t('m.tip.b_cancel'),\n            btnSecond: _this2.$t('m.common.b_unpair'),\n            status: 'vin'\n          };\n          _this2.showTip = true;\n          _this2.vinDisable = false;\n        }\n      }).catch(function (err) {\n        _this2.data2 = err.response.data.data;\n        _this2.title = _this2.$t('m.tip.warn');\n        _this2.content = _this2.$t('m.tip.vehicle_pair_warn', {\n          imei: err.response.data.data.deviceMac\n        });\n        _this2.btnGroup = {\n          btnFirst: _this2.$t('m.tip.b_cancel'),\n          btnSecond: _this2.$t('m.common.b_unpair'),\n          status: 'vin'\n        };\n        _this2.showTip = true;\n        _this2.vinDisable = false;\n      });\n    },\n    showStep3: function showStep3(data) {\n      this.step1 = false;\n      this.step2 = false;\n      this.step3 = true;\n      this.vehicleId = data.vehicleId;\n    },\n    clickStep1: function clickStep1() {\n      var _this3 = this;\n\n      httpClient.post('/api/v1/device/vehiceldetail/mac', {\n        deviceMac: this.deviceId\n      }).then(function (response) {\n        _this3.data1 = response.data.data;\n\n        if (_this3.data1.vin == '') {\n          _this3.step1 = false;\n          _this3.step2 = true;\n        } else {\n          _this3.title = _this3.$t('m.tip.warn');\n          _this3.content = _this3.$t('m.tip.vehicle_pair_vin', {\n            year: response.data.data.year,\n            make: response.data.data.make,\n            model: response.data.data.model,\n            vin: response.data.data.vin\n          });\n          _this3.btnGroup = {\n            btnFirst: _this3.$t('m.tip.b_cancel'),\n            btnSecond: _this3.$t('m.common.b_unpair')\n          };\n          _this3.showTip = true;\n        }\n      }).catch(function (err) {\n        if (!err.response.data.data) {\n          _this3.err = true;\n          _this3.imeiDisable = false;\n          _this3.imeiSuccess = false;\n          _this3.title = _this3.$t('m.tip.warn');\n          _this3.content = err.response.data.msg;\n          _this3.btnGroup = {\n            btnSecond: _this3.$t('m.tip.b_ok')\n          };\n          _this3.showTip = true;\n        } else {\n          _this3.data1 = err.response.data.data;\n\n          if (_this3.data1.vin == '') {\n            _this3.step1 = false;\n            _this3.step2 = true;\n          } else {\n            _this3.err = true;\n            _this3.imeiDisable = false;\n            _this3.imeiSuccess = false;\n            _this3.title = _this3.$t('m.tip.warn');\n            _this3.content = _this3.content = _this3.$t('m.tip.vehicle_pair_vin', {\n              year: err.response.data.data.year,\n              make: err.response.data.data.make,\n              model: err.response.data.data.model,\n              vin: err.response.data.data.vin\n            });\n            _this3.btnGroup = {\n              btnFirst: _this3.$t('m.tip.b_cancel'),\n              btnSecond: _this3.$t('m.common.b_unpair')\n            };\n            _this3.showTip = true;\n          }\n        }\n      });\n    }\n  }\n};",null]}