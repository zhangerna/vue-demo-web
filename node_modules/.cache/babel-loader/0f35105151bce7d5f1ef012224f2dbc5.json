{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/thread-loader/dist/cjs.js!/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js!/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/components/searchMapForGaoDe.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/components/searchMapForGaoDe.vue","mtime":1569392859000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { wgs84ToGcjo2, calCenter } from \"@/utils/coordtransform\";\nimport httpClient from '@/utils/httpclient';\nimport AMap from 'AMap';\nexport default {\n  name: \"SearchMapForGaode\",\n  props: [\"map\", \"from\"],\n  data: function data() {\n    return {\n      mapInfo: {\n        lots: [],\n        lat: 0,\n        lng: 0,\n        vehicleInfo: [],\n        showMult: true\n      },\n      lat: \"\",\n      lng: \"\",\n      myMap: {},\n      myInfoWindow: null,\n      safeLayer: null,\n      roadLayer: null,\n      source: null\n    };\n  },\n  watch: {\n    map: function map(newVal) {\n      this.mapInfo.lots = newVal.lots;\n      this.mapInfo.vehicleInfo = newVal.vehicles;\n      this.getMyMap();\n    },\n    from: function from(newVal) {\n      this.source = newVal;\n    }\n  },\n  mounted: function mounted() {\n    this.getMyMap();\n  },\n  methods: {\n    changeMapType: function changeMapType(type) {\n      if (type == 'default') {\n        this.roadLayer.hide();\n        this.safeLayer.hide();\n      } else {\n        this.roadLayer.show();\n        this.safeLayer.show();\n      }\n    },\n    getMyMap: function getMyMap() {\n      var _this = this;\n\n      var centerPoint;\n      var _arr = [];\n\n      if (this.mapInfo.vehicleInfo.length > 0) {\n        this.mapInfo.vehicleInfo.map(function (item) {\n          if (item.lastLocationLat && item.lastLocationLng) {\n            _arr.push({\n              lng: item.lastLocationLng,\n              lat: item.lastLocationLat\n            });\n          }\n        });\n        centerPoint = calCenter(_arr);\n      }\n\n      this.myMap = new AMap.Map(\"gaode-map\", {\n        //实例化一个地图\n        zoom: 12,\n        viewMode: '3D',\n        center: centerPoint\n      });\n      this.roadLayer = new AMap.TileLayer.RoadNet({});\n      this.myMap.addControl(new AMap.ControlBar());\n      this.myMap.addControl(new AMap.Scale({\n        visible: true\n      }));\n      this.myMap.add(this.roadLayer);\n      var area2 = [];\n\n      if (this.mapInfo.lots.length > 0) {\n        this.mapInfo.lots.map(function (item) {\n          //给地图加上指定停车红色区域\n          var myArr = [];\n          item.areaCoordinate.map(function (val) {\n            var temp = val.split(\",\");\n            myArr.push(wgs84ToGcjo2(Number(temp[0]), Number(temp[1])));\n          });\n          area2.push(myArr);\n        });\n      }\n\n      var polygon = new AMap.Polygon({\n        //给地图加上指定停车红色区域\n        path: area2,\n        strokeColor: '#FF0000',\n        strokeOpacity: 0.8,\n        strokeWeight: 2,\n        fillColor: '#FF0000',\n        fillOpacity: 0.35\n      });\n      this.myMap.add(polygon);\n      this.myInfoWindow = new AMap.InfoWindow({\n        offset: new AMap.Pixel(0, 0)\n      }); //初始化地图infoWindow\n\n      if (this.mapInfo.showMult) {\n        this.mapInfo.vehicleInfo.map(function (item) {\n          if (item.lastLocationLat && item.lastLocationLng) {\n            _this.addMarkers(item);\n          }\n        });\n        this.myMap.setFitView();\n      }\n\n      this.myMap.setFitView();\n    },\n    addMarkers: function addMarkers(item) {\n      console.log(item);\n      var lnglat = wgs84ToGcjo2(item.lastLocationLng, item.lastLocationLat);\n      var marker = new AMap.Marker({\n        position: lnglat,\n        map: this.myMap,\n        icon: new AMap.Icon({\n          image: item.currentVoltage && item.currentVoltage.toFixed(1) < 11.7 ? \"https://cdn2.shopify.com/s/files/1/0703/1149/files/Location_03580bd1-f466-4803-a69e-720a098b08a5.svg?828688\" : \"https://pic.zus.ai/saas/vehicle_normal.svg\",\n          size: new AMap.Size(20, 30),\n          imageSize: new AMap.Size(20, 30)\n        })\n      });\n      marker.content = '';\n      marker.item = item;\n      marker.on('click', this.markerClick);\n    },\n    markerClick: function markerClick(e) {\n      var _this2 = this;\n\n      //地图标记点击事件\n      var lang = '';\n\n      if (this.$i18n.locale === 'zh-CN') {\n        lang = 'China';\n      } else {\n        lang = 'US';\n      }\n\n      var item = e.target.item;\n      var link = '/api/v1/getlastLocation?lastlocationlat=' + item.lastLocationLat + '&lastlocationlng=' + item.lastLocationLng + '&country=' + lang;\n      httpClient.get(link).then(function (res) {\n        if (res.data.code === 200) {\n          var p = item.currentVoltage < 11.7 ? \"<p style=\\\"margin-bottom:6px;font-size: 12px;\\\">\".concat(_this2.$t('m.common.voltage'), \": <span style=\\\"color:red\\\"><i class=\\\"fa fa-exclamation-triangle\\\"></i>\").concat(item.currentVoltage ? item.currentVoltage.toFixed(1) + 'V' : '', \"</span></p>\") : \"<p style=\\\"margin-bottom:6px;font-size: 12px;\\\">\".concat(_this2.$t('m.common.voltage'), \":\").concat(item.currentVoltage ? item.currentVoltage.toFixed(1) + 'V' : '', \"</p>\");\n          var contentString = \"<div>\\n                            <img style=\\\"background: #3a4149\\\" src=\\\"\".concat(item.photoUrl ? item.photoUrl : '/img/placeholder.5367544d.svg', \"\\\" width=\\\"100%\\\" alt=\\\"\\\">\\n                        <a target=\\\"_blank\\\" href='/\").concat(item.saleStatus === 1 ? \"vehicle\" : \"sold-manager\", \"/detail/\").concat(item.vehicleId, \"'><h5 id=\\\"firstHeading\\\" class=\\\"firstHeading\\\">\").concat(item.year ? item.year : 'N/A', \" \").concat(item.make ? item.make : 'N/A', \" \").concat(item.model ? item.model : 'N/A', \" \").concat(item.alias ? \"-\" + item.alias : '', \"</h5></a>\\n                        <p style=\\\"margin-bottom:6px;font-size: 12px\\\">VIN:\").concat(item.vin, \"</p>\\n                        \").concat(p, \"\\n                        <p style=\\\"margin-bottom:6px;font-size: 12px\\\">\").concat(_this2.$t('m.common.last_location'), \":\").concat(res.data.data.locationName, \"</p>\\n                        <p style=\\\"margin-bottom:6px;font-size: 12px\\\">\").concat(_this2.$t('m.common.last_update'), \":\").concat(_this2.getYMDString(item.locationTime), \"</p>\\n                        </div>\");\n\n          _this2.myInfoWindow.setContent(contentString);\n\n          _this2.myInfoWindow.open(_this2.myMap, e.target.getPosition());\n        }\n      });\n    },\n    getYMDString: function getYMDString(time) {\n      //格式化时间\n      if (time) {\n        var date = new Date(time);\n        var Y = date.getFullYear() + ' ';\n        var M = date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1;\n        var D = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();\n        var h = date.getHours() < 10 ? '0' + date.getHours() : date.getHours();\n        var m = date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes();\n        return M + '/' + D + '/' + Y + ' ' + h + ':' + m + ' ';\n      } else {\n        return '';\n      }\n    }\n  }\n};",null]}