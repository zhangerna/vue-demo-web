{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js!/Users/nonda/nonda/nonda-saas-web/src/utils/httpclient.js","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/utils/httpclient.js","mtime":1562211754000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _JSON$stringify from \"/Users/nonda/nonda/nonda-saas-web/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport _Object$keys from \"/Users/nonda/nonda/nonda-saas-web/node_modules/@babel/runtime-corejs2/core-js/object/keys\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.regexp.split\";\nimport _Promise from \"/Users/nonda/nonda/nonda-saas-web/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport \"core-js/modules/es6.string.starts-with\";\nimport axios from 'axios';\nimport { Base64 } from 'js-base64';\nimport sha1 from 'js-sha1';\n\nvar uuidv4 = require('uuid/v4'); // axios.defaults.withCredentials = true;\n// axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';\n\n\nvar httpclient = axios.create({\n  baseURL: process.env.VUE_APP_BASE_URL,\n  timeout: 60000\n});\nvar loginApiPath = '/api/v1/login';\nvar checkLoginApiPath = '/api/v1/checklogin';\nhttpclient.defaults.withCredentials = true;\nhttpclient.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';\nhttpclient.interceptors.request.use(function (config) {\n  config.headers['X-Request-ZId'] = uuidv4();\n  config.headers['X-Request-Ztime'] = new Date().valueOf();\n  config.headers['X-Installation-Id'] = 'saas-web';\n  var url = config.url;\n\n  if (!url.startsWith(\"http\")) {\n    url = config.baseURL + url;\n  }\n\n  if (!config.params) {\n    config.params = {};\n  }\n\n  config.params['zos'] = 'web';\n  config.params['zname'] = 'web';\n  config.params['zversion'] = '1.0.0';\n  url = getUrl(url, config.params);\n  config.headers['X-Track-Id'] = buildTrackId(url, config.headers['X-Request-ZId'], config.headers['X-Request-Ztime'], config.headers['X-Installation-Id'], config.data); // console.log(config);\n\n  return config;\n}, function (error) {\n  return _Promise.reject(error);\n});\nhttpclient.interceptors.response.use(function (response) {\n  // return new Promise({\n  //     status: response.status,\n  //     data: response.data.data\n  // });\n  return response;\n}, function (error) {\n  if (error.response && !isLoginApi(error.response.config.url)) {\n    switch (error.response.status) {\n      case 401:\n        // todo: redirect to login page\n        // console.log(\"401\");\n        window.location.href = '/login';\n    }\n  }\n\n  return _Promise.reject(error);\n});\n\nfunction isLoginApi(url) {\n  return url.indexOf(loginApiPath) >= 0 || url.indexOf(checkLoginApiPath) >= 0;\n}\n\nfunction getUrl(url, params) {\n  var markIndex = url.indexOf('?');\n  var paramObj = {};\n  var urlPath = url;\n\n  if (markIndex > 0) {\n    var queryString = url.substring(markIndex + 1);\n    urlPath = url.substring(0, markIndex);\n    var arr = queryString.split('&'); // console.log(arr);\n\n    for (var i = 0; i < arr.length; i++) {\n      var paramArr = arr[i].split('=');\n      var key = paramArr[0];\n      var value = paramArr[1];\n      paramObj[key] = value;\n    }\n  }\n\n  if (params != undefined) {\n    for (var k in params) {\n      var v = params[k];\n      paramObj[k] = v;\n    }\n  }\n\n  var allKeys = _Object$keys(paramObj).sort();\n\n  var sortedQueryString = \"\";\n\n  for (var _i = 0; _i < allKeys.length; _i++) {\n    sortedQueryString += allKeys[_i] + \"=\" + paramObj[allKeys[_i]] + \"&\";\n  } // 去掉末尾的&\n\n\n  sortedQueryString = sortedQueryString.substring(0, sortedQueryString.length - 1);\n  return urlPath + \"?\" + sortedQueryString;\n}\n\nfunction buildTrackId(url, requestId, requestZtime, installId, body) {\n  var secret = 'nonda-saas-web';\n  var xTrackId = url + secret + requestId + installId + requestZtime;\n\n  if (body != undefined) {\n    var bodystr = _JSON$stringify(body);\n\n    if (bodystr !== '{}') {\n      xTrackId = xTrackId + _JSON$stringify(body);\n    }\n  }\n\n  return Base64.encode(sha1(xTrackId));\n}\n\nexport default httpclient;",{"version":3,"sources":["/Users/nonda/nonda/nonda-saas-web/src/utils/httpclient.js"],"names":["axios","Base64","sha1","uuidv4","require","httpclient","create","baseURL","process","env","VUE_APP_BASE_URL","timeout","loginApiPath","checkLoginApiPath","defaults","withCredentials","headers","common","interceptors","request","use","config","Date","valueOf","url","startsWith","params","getUrl","buildTrackId","data","error","reject","response","isLoginApi","status","window","location","href","indexOf","markIndex","paramObj","urlPath","queryString","substring","arr","split","i","length","paramArr","key","value","undefined","k","v","allKeys","sort","sortedQueryString","requestId","requestZtime","installId","body","secret","xTrackId","bodystr","encode"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport {Base64} from 'js-base64';\nimport sha1 from 'js-sha1';\n\nconst uuidv4 = require('uuid/v4');\n\n// axios.defaults.withCredentials = true;\n// axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';\n\n\nconst httpclient = axios.create({\n    baseURL: process.env.VUE_APP_BASE_URL,\n    timeout: 60000\n});\n\nconst loginApiPath = '/api/v1/login';\nconst checkLoginApiPath = '/api/v1/checklogin';\n\nhttpclient.defaults.withCredentials = true;\nhttpclient.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';\n\nhttpclient.interceptors.request.use(\n    config => {\n        config.headers['X-Request-ZId'] = uuidv4();\n        config.headers['X-Request-Ztime'] = new Date().valueOf();\n        config.headers['X-Installation-Id'] = 'saas-web';\n        let url = config.url;\n        if (!url.startsWith(\"http\")) {\n            url = config.baseURL + url;\n        }\n\n        if (!config.params) {\n            config.params = {};\n        }\n\n        config.params['zos'] = 'web';\n        config.params['zname'] = 'web';\n        config.params['zversion'] = '1.0.0';\n\n        url = getUrl(url, config.params);\n\n        config.headers['X-Track-Id'] = buildTrackId(url,\n            config.headers['X-Request-ZId'],\n            config.headers['X-Request-Ztime'],\n            config.headers['X-Installation-Id'],\n            config.data);\n\n        // console.log(config);\n\n        return config;\n    },\n    error => {\n        return Promise.reject(error);\n    }\n);\n\nhttpclient.interceptors.response.use(\n    response => {\n        // return new Promise({\n        //     status: response.status,\n        //     data: response.data.data\n        // });\n        return response;\n    },\n    error => {\n        if (error.response && !isLoginApi(error.response.config.url)) {\n            switch (error.response.status) {\n                case 401:\n                    // todo: redirect to login page\n                    // console.log(\"401\");\n                    window.location.href = '/login';\n            }\n        }\n        return Promise.reject(error);\n    }\n);\n\nfunction isLoginApi(url) {\n    return url.indexOf(loginApiPath) >= 0 || url.indexOf(checkLoginApiPath) >= 0;\n}\n\nfunction getUrl(url, params) {\n    let markIndex = url.indexOf('?');\n    let paramObj = {};\n    let urlPath = url;\n    if (markIndex > 0) {\n        let queryString = url.substring(markIndex + 1);\n        urlPath = url.substring(0, markIndex);\n        let arr = queryString.split('&');\n        // console.log(arr);\n        for (let i = 0; i < arr.length; i++) {\n            let paramArr = arr[i].split('=');\n            const key = paramArr[0];\n            const value = paramArr[1];\n            paramObj[key] = value;\n        }\n    }\n\n    if (params != undefined) {\n        for (let k in params) {\n            let v = params[k];\n            paramObj[k] = v;\n        }\n    }\n\n    let allKeys = Object.keys(paramObj).sort();\n\n    let sortedQueryString = \"\";\n    for (let i = 0; i < allKeys.length; i++) {\n        sortedQueryString += allKeys[i] + \"=\" + paramObj[allKeys[i]] + \"&\";\n    }\n    // 去掉末尾的&\n    sortedQueryString = sortedQueryString.substring(0, sortedQueryString.length - 1);\n\n    return urlPath + \"?\" + sortedQueryString;\n\n}\n\nfunction buildTrackId(url, requestId, requestZtime, installId, body) {\n    const secret = 'nonda-saas-web';\n    let xTrackId = url + secret + requestId + installId + requestZtime;\n    if (body != undefined) {\n        const bodystr = JSON.stringify(body);\n        if (bodystr !== '{}') {\n            xTrackId = xTrackId + JSON.stringify(body);\n        }\n    }\n    return Base64.encode(sha1(xTrackId));\n\n}\n\n\nexport default httpclient;\n"]}]}