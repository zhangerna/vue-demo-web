{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js!/Users/nonda/nonda/nonda-saas-web/src/utils/httpclient.js","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/utils/httpclient.js","mtime":1576812457000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _JSON$stringify from \"/Users/nonda/nonda/nonda-saas-web/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport _Object$keys from \"/Users/nonda/nonda/nonda-saas-web/node_modules/@babel/runtime-corejs2/core-js/object/keys\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.regexp.split\";\nimport _Promise from \"/Users/nonda/nonda/nonda-saas-web/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.string.starts-with\";\nimport axios from 'axios';\nimport { Base64 } from 'js-base64';\nimport sha1 from 'js-sha1';\nimport NProgress from \"nprogress\";\nimport store from '../store/index';\n\nvar uuidv4 = require('uuid/v4');\n\nvar httpclient = axios.create({\n  baseURL: process.env.VUE_APP_BASE_URL,\n  timeout: 60000\n});\nvar loginApiPath = '/api/v1/login';\nvar checkLoginApiPath = '/api/v1/checklogin';\nhttpclient.defaults.withCredentials = true;\nhttpclient.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';\nhttpclient.interceptors.request.use(function (config) {\n  config.headers['X-Request-ZId'] = uuidv4();\n  config.headers['X-Request-Ztime'] = new Date().valueOf();\n  config.headers['X-Installation-Id'] = 'saas-web';\n  var url = config.url;\n\n  if (!url.startsWith(\"http\")) {\n    url = config.baseURL + url;\n  }\n\n  if (!config.params) {\n    config.params = {};\n  }\n\n  config.params['zos'] = 'web';\n  config.params['zname'] = 'web';\n  config.params['zversion'] = '1.0.0';\n  config.params['language'] = localStorage.getItem(\"lang\") || 'en-US';\n\n  if (url.includes('getlastLocation')) {\n    config.headers['token'] = 'g8d6S6ZiKfKvEOl1HnfR';\n  }\n\n  if (url.indexOf('login') < 0 && url.indexOf('Login') < 0 && localStorage.getItem(\"role\") == 'root' && sessionStorage.getItem('storeId')) {\n    if (config.method == 'get') {\n      config.params['storeIdList'] = sessionStorage.getItem(\"storeId\");\n    }\n\n    if (config.method == 'post') {\n      config.data ? config.data[\"storeIdList\"] = [sessionStorage.getItem(\"storeId\")] : config.data = {\n        \"storeIdList\": [sessionStorage.getItem(\"storeId\")]\n      };\n    }\n  }\n\n  url = getUrl(url, config.params);\n  config.headers['X-Track-Id'] = buildTrackId(url, config.headers['X-Request-ZId'], config.headers['X-Request-Ztime'], config.headers['X-Installation-Id'], config.data);\n  NProgress.start();\n  return config;\n}, function (error) {\n  NProgress.done();\n  return _Promise.reject(error);\n});\nhttpclient.interceptors.response.use(function (response) {\n  NProgress.done();\n  return response;\n}, function (error) {\n  NProgress.done();\n\n  if (error.response && !isLoginApi(error.response.config.url)) {\n    switch (error.response.status) {\n      case 401:\n        window.location.href = '/login';\n        break;\n\n      case 403:\n        store.commit('CLOSE_GLOBAL_MODAL', true);\n        break;\n\n      case 404:\n        window.location.href = '/404';\n        break;\n    }\n  }\n\n  return _Promise.reject(error);\n});\n\nfunction isLoginApi(url) {\n  return url.indexOf(loginApiPath) >= 0 || url.indexOf(checkLoginApiPath) >= 0;\n}\n\nfunction getUrl(url, params) {\n  var markIndex = url.indexOf('?');\n  var paramObj = {};\n  var urlPath = url;\n\n  if (markIndex > 0) {\n    var queryString = url.substring(markIndex + 1);\n    urlPath = url.substring(0, markIndex);\n    var arr = queryString.split('&'); // console.log(arr);\n\n    for (var i = 0; i < arr.length; i++) {\n      var paramArr = arr[i].split('=');\n      var key = paramArr[0];\n      var value = encodeURIComponent(paramArr[1]);\n      paramObj[key] = value;\n    }\n  }\n\n  if (params != undefined) {\n    for (var k in params) {\n      var v = params[k];\n      paramObj[k] = v;\n    }\n  }\n\n  var allKeys = _Object$keys(paramObj).sort();\n\n  var sortedQueryString = \"\";\n\n  for (var _i = 0; _i < allKeys.length; _i++) {\n    sortedQueryString += allKeys[_i] + \"=\" + paramObj[allKeys[_i]] + \"&\";\n  } // 去掉末尾的&\n\n\n  sortedQueryString = sortedQueryString.substring(0, sortedQueryString.length - 1);\n  return urlPath + \"?\" + sortedQueryString;\n}\n\nfunction buildTrackId(url, requestId, requestZtime, installId, body) {\n  var secret = 'nonda-saas-web';\n  var xTrackId = url + secret + requestId + installId + requestZtime;\n\n  if (body != undefined) {\n    var bodystr = _JSON$stringify(body);\n\n    if (bodystr !== '{}') {\n      xTrackId = xTrackId + _JSON$stringify(body);\n    }\n  }\n\n  return Base64.encode(sha1(xTrackId));\n}\n\nexport default httpclient;",{"version":3,"sources":["/Users/nonda/nonda/nonda-saas-web/src/utils/httpclient.js"],"names":["axios","Base64","sha1","NProgress","store","uuidv4","require","httpclient","create","baseURL","process","env","VUE_APP_BASE_URL","timeout","loginApiPath","checkLoginApiPath","defaults","withCredentials","headers","common","interceptors","request","use","config","Date","valueOf","url","startsWith","params","localStorage","getItem","includes","indexOf","sessionStorage","method","data","getUrl","buildTrackId","start","error","done","reject","response","isLoginApi","status","window","location","href","commit","markIndex","paramObj","urlPath","queryString","substring","arr","split","i","length","paramArr","key","value","encodeURIComponent","undefined","k","v","allKeys","sort","sortedQueryString","requestId","requestZtime","installId","body","secret","xTrackId","bodystr","encode"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport {Base64} from 'js-base64';\nimport sha1 from 'js-sha1';\nimport NProgress from \"nprogress\";\nimport store from '../store/index'\nconst uuidv4 = require('uuid/v4');\nconst httpclient = axios.create({\n    baseURL: process.env.VUE_APP_BASE_URL,\n    timeout: 60000\n});\n\nconst loginApiPath = '/api/v1/login';\nconst checkLoginApiPath = '/api/v1/checklogin';\n\nhttpclient.defaults.withCredentials = true;\nhttpclient.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';\n\nhttpclient.interceptors.request.use(\n    config => {\n        config.headers['X-Request-ZId'] = uuidv4();\n        config.headers['X-Request-Ztime'] = new Date().valueOf();\n        config.headers['X-Installation-Id'] = 'saas-web';\n\n\n        let url = config.url;\n        if (!url.startsWith(\"http\")) {\n            url = config.baseURL + url;\n        }\n\n        if (!config.params) {\n            config.params = {};\n        }\n\n        config.params['zos'] = 'web';\n        config.params['zname'] = 'web';\n        config.params['zversion'] = '1.0.0';\n        config.params['language'] = localStorage.getItem(\"lang\") || 'en-US';\n\n        if (url.includes('getlastLocation')) {\n            config.headers['token'] = 'g8d6S6ZiKfKvEOl1HnfR';\n        }\n\n        if (url.indexOf('login') < 0 && url.indexOf('Login') < 0 && localStorage.getItem(\"role\") == 'root' && sessionStorage.getItem('storeId')) {\n            if (config.method == 'get') {\n                config.params['storeIdList'] = sessionStorage.getItem(\"storeId\");\n            }\n            if (config.method == 'post') {\n                config.data ?\n                    config.data[\"storeIdList\"] = [sessionStorage.getItem(\"storeId\")]\n                    : config.data = {\"storeIdList\": [sessionStorage.getItem(\"storeId\")]}\n            }\n        }\n\n        url = getUrl(url, config.params);\n\n        config.headers['X-Track-Id'] = buildTrackId(url,\n            config.headers['X-Request-ZId'],\n            config.headers['X-Request-Ztime'],\n            config.headers['X-Installation-Id'],\n            config.data);\n\n        NProgress.start();\n        return config;\n    },\n    error => {\n        NProgress.done();\n        return Promise.reject(error);\n    }\n);\n\n\n\nhttpclient.interceptors.response.use(\n    response => {\n        NProgress.done();\n        return response;\n    },\n    error => {\n        NProgress.done();\n        if (error.response && !isLoginApi(error.response.config.url)) {\n            switch (error.response.status) {\n                case 401:\n                    window.location.href = '/login';\n                    break;\n                case 403:\n                    store.commit('CLOSE_GLOBAL_MODAL',true);\n                    break;\n                case 404:\n                    window.location.href = '/404';\n                    break;\n            }\n        }\n        return Promise.reject(error);\n    }\n);\n\nfunction isLoginApi(url) {\n    return url.indexOf(loginApiPath) >= 0 || url.indexOf(checkLoginApiPath) >= 0;\n}\n\n\nfunction getUrl(url, params) {\n    let markIndex = url.indexOf('?');\n    let paramObj = {};\n    let urlPath = url;\n    if (markIndex > 0) {\n        let queryString = url.substring(markIndex + 1);\n        urlPath = url.substring(0, markIndex);\n        let arr = queryString.split('&');\n        // console.log(arr);\n        for (let i = 0; i < arr.length; i++) {\n            let paramArr = arr[i].split('=');\n            const key = paramArr[0];\n            const value = encodeURIComponent(paramArr[1]);\n            paramObj[key] = value;\n        }\n    }\n\n    if (params != undefined) {\n        for (let k in params) {\n            let v = params[k];\n            paramObj[k] = v;\n        }\n    }\n\n\n\n    let allKeys = Object.keys(paramObj).sort();\n\n    let sortedQueryString = \"\";\n    for (let i = 0; i < allKeys.length; i++) {\n        sortedQueryString += allKeys[i] + \"=\" + paramObj[allKeys[i]] + \"&\";\n    }\n    // 去掉末尾的&\n    sortedQueryString = sortedQueryString.substring(0, sortedQueryString.length - 1);\n    return urlPath + \"?\" + sortedQueryString;\n\n}\n\nfunction buildTrackId(url, requestId, requestZtime, installId, body) {\n    const secret = 'nonda-saas-web';\n    let xTrackId = url + secret + requestId + installId + requestZtime;\n    if (body != undefined) {\n        const bodystr = JSON.stringify(body);\n        if (bodystr !== '{}') {\n            xTrackId = xTrackId + JSON.stringify(body);\n        }\n    }\n\n    return Base64.encode(sha1(xTrackId));\n\n}\n\n\nexport default httpclient;\n"]}]}