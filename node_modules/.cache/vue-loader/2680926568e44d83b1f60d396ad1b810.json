{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/inventory/vehicleEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/inventory/vehicleEdit.vue","mtime":1577962918000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getDateString, getYMDString } from \"@/utils/date\";\nimport httpClient from \"@/utils/httpclient\";\nimport myMap from \"@components/map\";\nimport Alert from \"@components/model\";\nimport httpclient from \"@/utils/httpclient\";\n\nexport default {\n    name: \"edit\",\n    components: {\n        myMap,\n        Alert\n    },\n    data() {\n        return {\n            id: this.$router.currentRoute.params.id,\n            showMap: false,\n            image: \"\",\n            year: \"\",\n            lot: \"\",\n            vin: \"\",\n            priceUnit: \"\",\n            iMei: \"\",\n            price: \"\",\n            make: \"\",\n            alias: \"\",\n            color: \"\",\n            Odometer: \"\",\n            modal: \"\",\n            trim: \"\",\n            isOnline: \"\",\n            lastUpdateTime: \"\",\n            lastLocation: \"\",\n            engineType: \"\",\n            stockNumber: \"\",\n            plateNumber: \"\",\n            inventoryDate: \"\",\n            condition: \"\",\n            inventoryTime: \"\",\n            currentMileage: \"\",\n            selectedOption: \"\",\n            selectedCondition: \"\",\n            file: \"\",\n            boxOne: \"\",\n            curOperation: \"\",\n            lastLocationLat: \"\",\n            showAlerts: {\n                title: \"\",\n                show: false,\n                content: \"\",\n                buttonText: \"\"\n            },\n            conditionList: [\n                { c: this.$t(\"m.common.c_new\"), y: \"1\" },\n                { c: this.$t(\"m.common.c_used\"), y: \"3\" },\n                { c: this.$t(\"m.common.c_demo\"), y: \"2\" },\n                { c: this.$t(\"m.common.c_test\"), y: \"4\" }\n            ],\n            map: {},\n            changedLanguage: false,\n\n            photoUpload: this.$t(\"m.common.upload_img\"),\n            faSpinner: false,\n            circleCheck: false,\n            circleX: false,\n            pText: \"\",\n            showInput: true,\n            yearE: false,\n            makeE: false,\n            modalE: false,\n            bUnpair: false,\n            inputText: \"\",\n            installSuccess: false,\n            installStatus: false,\n            installDeviceStatus: false,\n            imeiIsVaild: false\n        };\n    },\n    watch: {\n        year() {\n            this.checkData();\n        },\n        make() {\n            this.checkData();\n        },\n        modal() {\n            this.checkData();\n        },\n        inputText(newV) {\n            if (newV.length === 15) {\n                this.imeiIsVaild = true;\n            } else {\n                this.imeiIsVaild = false;\n            }\n        }\n    },\n    mounted() {\n        //初始化各项数据\n        if (this.$i18n.locale === \"en-US\") {\n            this.changedLanguage = \"English\";\n        } else {\n            this.changedLanguage = \"Chinese\";\n        }\n\n        let that = this;\n        let url = \"/api/v1/vehicle/detail/id?vehicleId=\" + that.id;\n        httpClient.get(url).then(res => {\n            let myData = res.data.data;\n            that.image = myData.photoPath;\n            that.year = myData.year;\n            that.vin = myData.vin;\n            that.inventoryTime = myData.inventoryTime;\n\n            let _mileage = null; //距离单位转换\n            if (myData.currentMileage) {\n                if (that.changedLanguage === \"English\") {\n                    _mileage = (myData.currentMileage * 0.0006214).toFixed(0);\n                } else {\n                    _mileage = (myData.currentMileage / 1000).toFixed(0);\n                }\n            } else {\n                _mileage = \"N/A\";\n            }\n\n            that.currentMileage = _mileage;\n            that.lot = myData.parkingLot;\n            that.iMei = myData.deviceMac;\n            that.price = myData.price;\n            that.priceUnit = that.$t(\"m.common.moneyType\");\n            that.color = myData.color;\n            that.Odometer = _mileage;\n            that.make = myData.make;\n            that.alias = myData.alias;\n            that.lastLocationLat = myData.lastLocationLat;\n            that.modal = myData.model;\n            that.trim = myData.trim;\n            that.engineType = myData.engineType;\n            that.condition = myData.vehicleType;\n            that.stockNumber = myData.stockNumber;\n            that.plateNumber = myData.plate;\n            that.selectedOption = myData.color;\n            that.selectedCondition = myData.vehicleTypeCode;\n            that.lastLocation = myData.lastLocation;\n            that.isOnline = myData.isOnline;\n            myData.lastUpdateTime !== null ? (that.lastUpdateTime = getDateString(myData.lastUpdateTime)) : (that.lastUpdateTime = \"N/A\");\n            myData.inventoryTime !== null ? (that.inventoryDate = getYMDString(myData.inventoryTime)) : \"\";\n            that.map = {\n                lat: myData.lastLocationLat === null ? 0 : myData.lastLocationLat,\n                lng: myData.lastLocationLng === null ? 0 : myData.lastLocationLng,\n                area: myData.areaCoordinates === null ? [] : myData.areaCoordinates,\n                vehicleInfo: \"info\"\n            };\n        });\n    },\n    methods: {\n        format_number(nStr) {\n            nStr += \"\";\n            let x = nStr.split(\".\");\n            let x1 = x[0];\n            let x2 = x.length > 1 ? \".\" + x[1] : \"\";\n            var rgx = /(\\d+)(\\d{3})/;\n            while (rgx.test(x1)) {\n                x1 = x1.replace(rgx, \"$1\" + \",\" + \"$2\");\n            }\n            return x1 + x2;\n        },\n        showMapTip() {\n            if (this.map.lat || this.map.area.length > 0) {\n                this.showMap = true;\n            }\n        },\n        getFile(event) {\n            //图片上传\n            this.file = event.target.files[0];\n            let formData = new FormData();\n            formData.append(\"file\", this.file); //‘file’是後台接收文件名\n            let config = {\n                headers: {\n                    \"Content-Type\": \"multipart/form-data\"\n                }\n            };\n            let self = this;\n            this.faSpinner = true;\n            this.pText = this.$t(\"m.tip.upload_img\");\n            this.showInput = false;\n            httpClient\n                .post(\"/api/v1/uploadFile\", formData, config)\n                .then(res => {\n                    if (res.data.code == 200) {\n                        // let passData = {\n                        //     title: self.$t(\"m.tip.info\"),\n                        //     show: true,\n                        //     content: self.$t(\"m.tip.upload\"),\n                        //     buttonText: {\n                        //         btnFirst: \"\",\n                        //         btnSecond: self.$t(\"m.tip.b_ok\")\n                        //     }\n                        // };\n                        // self.closeRemind(passData);\n                        self.image = res.data.data.path;\n                        this.faSpinner = false;\n                        this.circleCheck = true;\n                        this.pText = this.$t(\"m.tip.upload_success\");\n                        this.showInput = true;\n                        this.photoUpload = this.$t(\"m.common.re_upload\");\n                    }\n                })\n                .catch(function(err) {\n                    if (err) {\n                        // let passData = {\n                        //     title: self.$t(\"m.tip.info\"),\n                        //     show: true,\n                        //     content: self.$t(\"m.tip.upload_failed\"),\n                        //     buttonText: {\n                        //         btnFirst: \"\",\n                        //         btnSecond: self.$t(\"m.tip.b_ok\")\n                        //     }\n                        // };\n                        // self.closeRemind(passData);\n                        this.faSpinner = false;\n                        this.circleX = true;\n                        this.pText = this.$t(\"m.tip.upload_fail\");\n                        this.showInput = true;\n                        this.photoUpload = this.$t(\"m.common.re_upload\");\n                    }\n                });\n        },\n        checkData() {\n            this.yearE = this.year ? false : true;\n            this.makeE = this.make ? false : true;\n            this.modalE = this.modal ? false : true;\n        },\n        saveData() {\n            //设备参数更新，保存\n            this.curOperation = \"update\";\n            function convertDateToTime(strtime) {\n                var date = new Date(strtime);\n                return date.getTime();\n            }\n\n            function isInteger(obj) {\n                return typeof obj === \"number\" && obj % 1 === 0;\n            }\n\n            let _time = convertDateToTime(this.inventoryDate);\n            let dataTime;\n            if (_time && isInteger(_time)) {\n                dataTime = _time;\n            }\n\n            let _mileage = null;\n            if (this.Odometer) {\n                if (this.changedLanguage === \"English\") {\n                    _mileage = (this.Odometer / 0.0006214).toFixed(0);\n                } else {\n                    _mileage = (this.Odometer * 1000).toFixed(0);\n                }\n            } else {\n                _mileage = 0;\n            }\n\n            let _data = {\n                color: this.selectedOption,\n                currentMileage: _mileage,\n                engineType: this.engineType,\n                id: this.$router.currentRoute.params.id,\n                inventoryTime: dataTime,\n                make: this.make,\n                model: this.modal,\n                alias: this.alias,\n                photoPath: this.image,\n                plat: this.plateNumber,\n                price: this.price,\n                stockNumber: this.stockNumber,\n                trim: this.trim,\n                vehicleTypeCode: this.selectedCondition,\n                year: this.year\n            };\n\n            let link = \"/api/v1/vehicle/update\";\n            let self = this;\n            this.checkData();\n            if (!this.yearE && !this.makeE && !this.modelE) {\n                httpClient\n                    .post(link, _data)\n                    .then(function(res) {\n                        if (res.data.data && res.data.data.result) {\n                            let passData = {\n                                title: self.$t(\"m.tip.info\"),\n                                show: true,\n                                content: self.$t(\"m.tip.vehicle_upsucc\"),\n                                buttonText: {\n                                    btnFirst: \"\",\n                                    btnSecond: self.$t(\"m.tip.b_ok\"),\n                                    origin: \"save\"\n                                }\n                            };\n                            self.closeRemind(passData);\n                        }\n                    })\n                    .catch(function(err) {\n                        if (err) {\n                            let passData = {\n                                title: self.$t(\"m.tip.info\"),\n                                show: true,\n                                content: self.$t(\"m.tip.vehicle_upfail\"),\n                                buttonText: {\n                                    btnFirst: \"\",\n                                    btnSecond: self.$t(\"m.tip.b_ok\"),\n                                    origin: \"save\"\n                                }\n                            };\n                            self.closeRemind(passData);\n                        }\n                    });\n            }\n        },\n        showBindInfo() {\n            this.installDeviceStatus = !this.installDeviceStatus;\n        },\n        installDevice() {\n            httpclient\n                .post(\"/api/v1/clouddrive/device/box/bind\", {\n                    deviceImei: this.inputText,\n                    vehicleId: this.$route.params.id,\n                    deviceType: 1\n                })\n                .then(res => {\n                    if (res.data.code === 200 && res.data.data.result) {\n                        this.installStatus = true;\n                        this.installSuccess = true;\n                        // window.location.reload();\n                    } else {\n                        this.installStatus = false;\n                        this.installSuccess = true;\n                    }\n                });\n        },\n        reloadPage() {\n            window.location.reload();\n        },\n        unPairdevice() {\n            //设备解绑，未绑定的设备，按钮不显示\n            this.curOperation = \"\";\n            let link = \"/api/v1/vehicle/unbind/device\";\n            let self = this;\n            let data = {\n                deviceMac: this.iMei,\n                vin: this.vin\n            };\n            httpClient\n                .post(link, data)\n                .then(function(res) {\n                    if (res.data.code === 200) {\n                        let passData = {\n                            title: self.$t(\"m.tip.info\"),\n                            show: true,\n                            content: self.$t(\"m.tip.vehicle_unpair_success\"),\n                            buttonText: {\n                                btnFirst: \"\",\n                                btnSecond: self.$t(\"m.tip.b_ok\")\n                            }\n                        };\n                        self.closeRemind(passData);\n                    }\n                })\n                .catch(function(err) {\n                    if (err) {\n                        let passData = {\n                            title: self.$t(\"m.tip.info\"),\n                            show: true,\n                            content: self.$t(\"m.tip.vehicle_unpair_failed\"),\n                            buttonText: {\n                                btnFirst: \"\",\n                                btnSecond: self.$t(\"m.tip.b_ok\")\n                            }\n                        };\n                        self.closeRemind(passData);\n                    }\n                });\n        },\n        closeRemind(data) {\n            this.showAlerts.show = data.show;\n            this.showAlerts.title = data.title;\n            this.showAlerts.content = data.content;\n            this.showAlerts.buttonText = data.buttonText;\n        },\n        closeBox(type) {\n            //子组件来请求父组件关闭弹窗\n            window.location.reload();\n            if (type && this.curOperation == \"update\") {\n                this.$router.push(\"/inventory/vehicle/list\");\n            } else {\n                this.showAlerts.show = false;\n            }\n        }\n    }\n};\n",{"version":3,"sources":["vehicleEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyNA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"vehicleEdit.vue","sourceRoot":"src/views/dashboard/inventory","sourcesContent":["<template>\n    <div class=\"animated fadeIn car-edit\">\n        <b-card>\n            <div slot=\"header\">{{ $t(\"m.vehicle_edit.title\") }}</div>\n            <div class=\"content\">\n                <b-col class=\"col-sm-6 float-right right-box\">\n                    <div class=\"inner-box\">\n                        <i v-show=\"faSpinner\" class=\"fa fa-spinner fa-lg mt-4 i-white\"></i>\n                        <i v-show=\"circleCheck\" class=\" font-2xl cui-circle-check i-success\"></i>\n                        <i v-show=\"circleX\" class=\" font-2xl cui-circle-x i-danger\"></i>\n                        <img :src=\"image\" alt height=\"100%\" width=\"100%\" style=\"border:none\" />\n                        <input v-show=\"showInput\" class=\"right-input-one\" type=\"button\" id=\"btn\" :value=\"photoUpload\" />\n                        <p class=\"right-p\" v-text=\"pText\">{{ $t(\"m.tip.uploadText\") }}</p>\n                        <input class=\"right-input-two\" type=\"file\" style=\"opacity: 0;cursor:pointer\" id=\"fileinp\" @change=\"getFile($event)\" />\n                    </div>\n                </b-col>\n                <div style=\"padding:15px;margin-bottom:30px\" class=\"col-sm-6\">\n                    <b-col sm=\"12\">\n                        <Alert @closeRemindBox=\"closeBox\" :buttonText=\"showAlerts.buttonText\" :show=\"showAlerts.show\" :title=\"showAlerts.title\" :content=\"showAlerts.content\"> </Alert>\n                        <div>\n                            <b-row class=\"specific-data\">\n                                <b-col sm=\"4\" md=\"4\" lg=\"4\">\n                                    <span>{{ $t(\"m.common.vin\") }}</span>\n                                </b-col>\n                                <b-col sm=\"8\" md=\"8\" lg=\"8\">\n                                    <span class=\"text-right\">{{ vin }}</span>\n                                </b-col>\n                            </b-row>\n                            <b-row class=\"specific-data\">\n                                <b-col sm=\"4\" md=\"4\" lg=\"4\">\n                                    <span>{{ $t(\"m.common.imei\") }}</span>\n                                </b-col>\n                                <b-col sm=\"8\" md=\"8\" lg=\"8\">\n                                    \n                                     <span v-if=\"iMei\">{{ iMei }}</span>\n                                     <span v-else class=\"online-gray\">{{ $t(\"m.vehicle.unbound\") }}</span>       \n                                    <b-button style=\"margin-left:10px;\" v-if=\"!iMei\" pressed size=\"sm\" variant=\"primary\" aria-pressed=\"true\" class=\"button-primary\" @click=\"showBindInfo\">{{ $t(\"m.vehicle.install_device\") }}</b-button>\n                                    <b-button style=\"margin-left:10px;\" v-else pressed size=\"sm\" variant=\"danger\" aria-pressed=\"true\" class=\"button-red\" @click=\"bUnpair = true\">{{ $t(\"m.common.b_unpair\") }}</b-button>\n                                </b-col>\n                            </b-row>\n                            <b-row class=\"specific-data\">\n                                <b-col sm=\"4\" md=\"4\" lg=\"4\">\n                                    <span>{{ $t(\"m.common.line_status\") }}</span>\n                                </b-col>\n                                <b-col sm=\"8\" md=\"8\" lg=\"8\">\n                                    <span v-if=\"isOnline === 1\" class=\"online-success\">{{ $t(\"m.common.online\") }}</span>\n                                    <span v-if=\"isOnline === 2\" class=\"online-danger\">{{ $t(\"m.common.offline\") }}</span>\n                                    <span v-if=\"isOnline === 3\" class=\"online-gray\">{{ $t(\"m.vehicle.unbound\") }}</span>\n                                </b-col>\n                            </b-row>\n                            <b-row class=\"specific-data\">\n                                <b-col sm=\"4\" md=\"4\" lg=\"4\">\n                                    <span>Lot{{ $t(\"m.common.lot\") }}</span>\n                                </b-col>\n                                <b-col sm=\"8\" md=\"8\" lg=\"8\">\n                                    <span class=\"text-right\">{{ lot }}</span>\n                                </b-col>\n                            </b-row>\n                            <b-row class=\"specific-data\">\n                                <b-col sm=\"4\" md=\"4\" lg=\"4\">\n                                    <span>{{ $t(\"m.common.last_update\") }}</span>\n                                </b-col>\n                                <b-col sm=\"8\" md=\"8\" lg=\"8\">\n                                    <span class=\"text-right\">{{ lastUpdateTime }}</span>\n                                </b-col>\n                            </b-row>\n                            <b-row class=\"specific-data sp-box\">\n                                <b-col sm=\"4\" md=\"4\" lg=\"4\">\n                                    <span>{{ $t(\"m.common.last_location\") }}</span>\n                                </b-col>\n                                <b-col sm=\"8\" md=\"8\" lg=\"8\">\n                                    <span class=\"text-right\">{{ lastLocation ? lastLocation : \"N/A\" }}</span>\n                                    <!-- <span class=\"text-right google-maps\" @click=\"showMapTip\"><i class=\"cui cui-location-pin\"></i></span> -->\n                                </b-col>\n                            </b-row>\n                        </div>\n                    </b-col>\n                </div>\n\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.year\") }}</label> <span class=\"star-red\">*</span>\n                        <input :class=\"yearE ? 'is-exist' : ''\" class=\"form-control\" name=\"year\" id=\"vehicleyear\" type=\"text\" v-model=\"year\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.make\") }}</label> <span class=\"star-red\">*</span>\n                        <input :class=\"makeE ? 'is-exist' : ''\" class=\"form-control\" name=\"make\" id=\"vehiclemake\" type=\"text\" v-model=\"make\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.model\") }}</label> <span class=\"star-red\">*</span>\n                        <input :class=\"modalE ? 'is-exist' : ''\" class=\"form-control\" name=\"model\" id=\"vehiclemodel\" type=\"text\" v-model=\"modal\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group required\">\n                        <label>{{ $t(\"m.common.alias\") }}</label>\n                        <input class=\"form-control\" name=\"alias\" id=\"vehiclealias\" type=\"text\" v-model=\"alias\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group required\">\n                        <label>{{ $t(\"m.common.trim\") }}</label>\n                        <input class=\"form-control\" name=\"trim\" id=\"vehicletrim\" type=\"text\" v-model=\"trim\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.engine\") }}</label>\n                        <input class=\"form-control\" name=\"engineType\" id=\"vehicleengine\" type=\"text\" v-model=\"engineType\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.color\") }}</label>\n                        <input class=\"form-control\" type=\"text\" v-model=\"selectedOption\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group price-dorlar\">\n                        <label>{{ $t(\"m.common.price\") }}</label\n                        ><br />\n                        <b-input-group>\n                            <b-input-group-prepend>\n                                <b-input-group-text>{{ priceUnit }}</b-input-group-text>\n                            </b-input-group-prepend>\n                            <b-form-input id=\"elementsEmail\" type=\"number\" v-model=\"price\"></b-form-input>\n                        </b-input-group>\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.stock_num\") }}</label>\n                        <input class=\"form-control\" name=\"stockNumber\" id=\"vehiclestock\" type=\"text\" v-model=\"stockNumber\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.inv_date\") }}</label>\n                        <input class=\"form-control\" name=\"\" id=\"vehicleinventory\" type=\"date\" v-model=\"inventoryDate\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.cloud.vehicle_type\") }}</label>\n                        <select class=\"form-control\" name=\"\" id=\"vehicletype\" v-model=\"selectedCondition\">\n                            <option v-for=\"(item, index) in conditionList\" :key=\"index\" :value=\"item.y\">{{ item.c }}</option>\n                        </select>\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.odometer\") }}</label>\n                        <input class=\"form-control\" name=\"currentMileage\" id=\"vehiclemileage\" type=\"text\" v-model=\"Odometer\" />\n                    </div>\n                </div>\n                <div class=\"col-sm-6 \">\n                    <div class=\"form-group\">\n                        <label>{{ $t(\"m.common.plate_num\") }}</label>\n                        <input class=\"form-control\" name=\"plat\" id=\"vehicleplat\" type=\"text\" v-model=\"plateNumber\" />\n                    </div>\n                </div>\n            </div>\n            <div class=\"row justify-content-center\">\n                <div class=\"col-6 text-center\">\n                    <button class=\"btn btn-sm btn-info text-white mx-3 px-3\" type=\"button\" @click=\"saveData\">\n                        {{ $t(\"m.common.b_save\") }}\n                    </button>\n                </div>\n            </div>\n        </b-card>\n\n        <b-modal class=\"show-map\" id=\"modal-1\" title=\"Google Map\" v-model=\"showMap\" @ok=\"showMap = false\">\n            <myMap :map=\"map\"></myMap>\n        </b-modal>\n\n        <b-modal class=\"lock-my-car\" ref=\"my-modal\" v-model=\"bUnpair\" :title=\"$t('m.cloud.confirmUnbundling')\" :cancel-title=\"$t('m.tip.b_cancel')\" :ok-title=\"$t('m.tip.confirm')\" @ok=\"unPairdevice()\">\n            <p class=\"text-center\">\n                {{ $t(\"m.cloud.confirm_Unbund\") }}\n            </p>\n        </b-modal>\n\n        <b-modal ref=\"my-modal-7\" v-model=\"installDeviceStatus\" :ok-disabled=\"!imeiIsVaild\" :ok-title=\"$t('m.tip.b_ok')\" @ok=\"installDevice()\" class=\"select-store\" ok-only>\n            <template slot=\"modal-title\">\n                {{ this.$t(\"m.vehicle.install_device\") }}\n            </template>\n            <div class=\"text-left\">\n                <div class=\"select-box\">\n                    <div class=\"col-md-3\">\n                        <p>{{ this.$t(\"m.vehicle.input_mind\") }}</p>\n                    </div>\n                    <div class=\"col-md-9\">\n                        <b-form-input type=\"text\" aria-describedby=\"input-live-help input-live-feedback\" id=\"input-live\" :placeholder=\"$t('m.vehicle.input_mind')\" v-model=\"inputText\" :class=\"!imeiIsVaild ? 'is-invalid' : ''\" maxlength=\"15\"></b-form-input>\n                        <b-form-invalid-feedback id=\"input-live-feedback\" v-if=\"!imeiIsVaild\">\n                            {{ $t(\"m.car_box.IMEI_verify\") }}\n                        </b-form-invalid-feedback>\n                    </div>\n                </div>\n            </div>\n        </b-modal>\n\n        <b-modal ref=\"my-modal-6\" v-model=\"installStatus\" @ok=\"installSuccess ? reloadPage() : ''\" :ok-title=\"$t('m.tip.b_ok')\" class=\"select-store\" ok-only>\n            <template slot=\"modal-title\">\n                {{ $t(\"m.cloud.vehicle_oper\") }}\n            </template>\n            <div class=\"text-left\">\n                <p>\n                    {{ installSuccess === true ? $t(\"m.cloud.insert_succ_title\") : $t(\"m.tip.update_failed\") }}\n                </p>\n            </div>\n        </b-modal>\n    </div>\n</template>\n<script>\nimport { getDateString, getYMDString } from \"@/utils/date\";\nimport httpClient from \"@/utils/httpclient\";\nimport myMap from \"@components/map\";\nimport Alert from \"@components/model\";\nimport httpclient from \"@/utils/httpclient\";\n\nexport default {\n    name: \"edit\",\n    components: {\n        myMap,\n        Alert\n    },\n    data() {\n        return {\n            id: this.$router.currentRoute.params.id,\n            showMap: false,\n            image: \"\",\n            year: \"\",\n            lot: \"\",\n            vin: \"\",\n            priceUnit: \"\",\n            iMei: \"\",\n            price: \"\",\n            make: \"\",\n            alias: \"\",\n            color: \"\",\n            Odometer: \"\",\n            modal: \"\",\n            trim: \"\",\n            isOnline: \"\",\n            lastUpdateTime: \"\",\n            lastLocation: \"\",\n            engineType: \"\",\n            stockNumber: \"\",\n            plateNumber: \"\",\n            inventoryDate: \"\",\n            condition: \"\",\n            inventoryTime: \"\",\n            currentMileage: \"\",\n            selectedOption: \"\",\n            selectedCondition: \"\",\n            file: \"\",\n            boxOne: \"\",\n            curOperation: \"\",\n            lastLocationLat: \"\",\n            showAlerts: {\n                title: \"\",\n                show: false,\n                content: \"\",\n                buttonText: \"\"\n            },\n            conditionList: [\n                { c: this.$t(\"m.common.c_new\"), y: \"1\" },\n                { c: this.$t(\"m.common.c_used\"), y: \"3\" },\n                { c: this.$t(\"m.common.c_demo\"), y: \"2\" },\n                { c: this.$t(\"m.common.c_test\"), y: \"4\" }\n            ],\n            map: {},\n            changedLanguage: false,\n\n            photoUpload: this.$t(\"m.common.upload_img\"),\n            faSpinner: false,\n            circleCheck: false,\n            circleX: false,\n            pText: \"\",\n            showInput: true,\n            yearE: false,\n            makeE: false,\n            modalE: false,\n            bUnpair: false,\n            inputText: \"\",\n            installSuccess: false,\n            installStatus: false,\n            installDeviceStatus: false,\n            imeiIsVaild: false\n        };\n    },\n    watch: {\n        year() {\n            this.checkData();\n        },\n        make() {\n            this.checkData();\n        },\n        modal() {\n            this.checkData();\n        },\n        inputText(newV) {\n            if (newV.length === 15) {\n                this.imeiIsVaild = true;\n            } else {\n                this.imeiIsVaild = false;\n            }\n        }\n    },\n    mounted() {\n        //初始化各项数据\n        if (this.$i18n.locale === \"en-US\") {\n            this.changedLanguage = \"English\";\n        } else {\n            this.changedLanguage = \"Chinese\";\n        }\n\n        let that = this;\n        let url = \"/api/v1/vehicle/detail/id?vehicleId=\" + that.id;\n        httpClient.get(url).then(res => {\n            let myData = res.data.data;\n            that.image = myData.photoPath;\n            that.year = myData.year;\n            that.vin = myData.vin;\n            that.inventoryTime = myData.inventoryTime;\n\n            let _mileage = null; //距离单位转换\n            if (myData.currentMileage) {\n                if (that.changedLanguage === \"English\") {\n                    _mileage = (myData.currentMileage * 0.0006214).toFixed(0);\n                } else {\n                    _mileage = (myData.currentMileage / 1000).toFixed(0);\n                }\n            } else {\n                _mileage = \"N/A\";\n            }\n\n            that.currentMileage = _mileage;\n            that.lot = myData.parkingLot;\n            that.iMei = myData.deviceMac;\n            that.price = myData.price;\n            that.priceUnit = that.$t(\"m.common.moneyType\");\n            that.color = myData.color;\n            that.Odometer = _mileage;\n            that.make = myData.make;\n            that.alias = myData.alias;\n            that.lastLocationLat = myData.lastLocationLat;\n            that.modal = myData.model;\n            that.trim = myData.trim;\n            that.engineType = myData.engineType;\n            that.condition = myData.vehicleType;\n            that.stockNumber = myData.stockNumber;\n            that.plateNumber = myData.plate;\n            that.selectedOption = myData.color;\n            that.selectedCondition = myData.vehicleTypeCode;\n            that.lastLocation = myData.lastLocation;\n            that.isOnline = myData.isOnline;\n            myData.lastUpdateTime !== null ? (that.lastUpdateTime = getDateString(myData.lastUpdateTime)) : (that.lastUpdateTime = \"N/A\");\n            myData.inventoryTime !== null ? (that.inventoryDate = getYMDString(myData.inventoryTime)) : \"\";\n            that.map = {\n                lat: myData.lastLocationLat === null ? 0 : myData.lastLocationLat,\n                lng: myData.lastLocationLng === null ? 0 : myData.lastLocationLng,\n                area: myData.areaCoordinates === null ? [] : myData.areaCoordinates,\n                vehicleInfo: \"info\"\n            };\n        });\n    },\n    methods: {\n        format_number(nStr) {\n            nStr += \"\";\n            let x = nStr.split(\".\");\n            let x1 = x[0];\n            let x2 = x.length > 1 ? \".\" + x[1] : \"\";\n            var rgx = /(\\d+)(\\d{3})/;\n            while (rgx.test(x1)) {\n                x1 = x1.replace(rgx, \"$1\" + \",\" + \"$2\");\n            }\n            return x1 + x2;\n        },\n        showMapTip() {\n            if (this.map.lat || this.map.area.length > 0) {\n                this.showMap = true;\n            }\n        },\n        getFile(event) {\n            //图片上传\n            this.file = event.target.files[0];\n            let formData = new FormData();\n            formData.append(\"file\", this.file); //‘file’是後台接收文件名\n            let config = {\n                headers: {\n                    \"Content-Type\": \"multipart/form-data\"\n                }\n            };\n            let self = this;\n            this.faSpinner = true;\n            this.pText = this.$t(\"m.tip.upload_img\");\n            this.showInput = false;\n            httpClient\n                .post(\"/api/v1/uploadFile\", formData, config)\n                .then(res => {\n                    if (res.data.code == 200) {\n                        // let passData = {\n                        //     title: self.$t(\"m.tip.info\"),\n                        //     show: true,\n                        //     content: self.$t(\"m.tip.upload\"),\n                        //     buttonText: {\n                        //         btnFirst: \"\",\n                        //         btnSecond: self.$t(\"m.tip.b_ok\")\n                        //     }\n                        // };\n                        // self.closeRemind(passData);\n                        self.image = res.data.data.path;\n                        this.faSpinner = false;\n                        this.circleCheck = true;\n                        this.pText = this.$t(\"m.tip.upload_success\");\n                        this.showInput = true;\n                        this.photoUpload = this.$t(\"m.common.re_upload\");\n                    }\n                })\n                .catch(function(err) {\n                    if (err) {\n                        // let passData = {\n                        //     title: self.$t(\"m.tip.info\"),\n                        //     show: true,\n                        //     content: self.$t(\"m.tip.upload_failed\"),\n                        //     buttonText: {\n                        //         btnFirst: \"\",\n                        //         btnSecond: self.$t(\"m.tip.b_ok\")\n                        //     }\n                        // };\n                        // self.closeRemind(passData);\n                        this.faSpinner = false;\n                        this.circleX = true;\n                        this.pText = this.$t(\"m.tip.upload_fail\");\n                        this.showInput = true;\n                        this.photoUpload = this.$t(\"m.common.re_upload\");\n                    }\n                });\n        },\n        checkData() {\n            this.yearE = this.year ? false : true;\n            this.makeE = this.make ? false : true;\n            this.modalE = this.modal ? false : true;\n        },\n        saveData() {\n            //设备参数更新，保存\n            this.curOperation = \"update\";\n            function convertDateToTime(strtime) {\n                var date = new Date(strtime);\n                return date.getTime();\n            }\n\n            function isInteger(obj) {\n                return typeof obj === \"number\" && obj % 1 === 0;\n            }\n\n            let _time = convertDateToTime(this.inventoryDate);\n            let dataTime;\n            if (_time && isInteger(_time)) {\n                dataTime = _time;\n            }\n\n            let _mileage = null;\n            if (this.Odometer) {\n                if (this.changedLanguage === \"English\") {\n                    _mileage = (this.Odometer / 0.0006214).toFixed(0);\n                } else {\n                    _mileage = (this.Odometer * 1000).toFixed(0);\n                }\n            } else {\n                _mileage = 0;\n            }\n\n            let _data = {\n                color: this.selectedOption,\n                currentMileage: _mileage,\n                engineType: this.engineType,\n                id: this.$router.currentRoute.params.id,\n                inventoryTime: dataTime,\n                make: this.make,\n                model: this.modal,\n                alias: this.alias,\n                photoPath: this.image,\n                plat: this.plateNumber,\n                price: this.price,\n                stockNumber: this.stockNumber,\n                trim: this.trim,\n                vehicleTypeCode: this.selectedCondition,\n                year: this.year\n            };\n\n            let link = \"/api/v1/vehicle/update\";\n            let self = this;\n            this.checkData();\n            if (!this.yearE && !this.makeE && !this.modelE) {\n                httpClient\n                    .post(link, _data)\n                    .then(function(res) {\n                        if (res.data.data && res.data.data.result) {\n                            let passData = {\n                                title: self.$t(\"m.tip.info\"),\n                                show: true,\n                                content: self.$t(\"m.tip.vehicle_upsucc\"),\n                                buttonText: {\n                                    btnFirst: \"\",\n                                    btnSecond: self.$t(\"m.tip.b_ok\"),\n                                    origin: \"save\"\n                                }\n                            };\n                            self.closeRemind(passData);\n                        }\n                    })\n                    .catch(function(err) {\n                        if (err) {\n                            let passData = {\n                                title: self.$t(\"m.tip.info\"),\n                                show: true,\n                                content: self.$t(\"m.tip.vehicle_upfail\"),\n                                buttonText: {\n                                    btnFirst: \"\",\n                                    btnSecond: self.$t(\"m.tip.b_ok\"),\n                                    origin: \"save\"\n                                }\n                            };\n                            self.closeRemind(passData);\n                        }\n                    });\n            }\n        },\n        showBindInfo() {\n            this.installDeviceStatus = !this.installDeviceStatus;\n        },\n        installDevice() {\n            httpclient\n                .post(\"/api/v1/clouddrive/device/box/bind\", {\n                    deviceImei: this.inputText,\n                    vehicleId: this.$route.params.id,\n                    deviceType: 1\n                })\n                .then(res => {\n                    if (res.data.code === 200 && res.data.data.result) {\n                        this.installStatus = true;\n                        this.installSuccess = true;\n                        // window.location.reload();\n                    } else {\n                        this.installStatus = false;\n                        this.installSuccess = true;\n                    }\n                });\n        },\n        reloadPage() {\n            window.location.reload();\n        },\n        unPairdevice() {\n            //设备解绑，未绑定的设备，按钮不显示\n            this.curOperation = \"\";\n            let link = \"/api/v1/vehicle/unbind/device\";\n            let self = this;\n            let data = {\n                deviceMac: this.iMei,\n                vin: this.vin\n            };\n            httpClient\n                .post(link, data)\n                .then(function(res) {\n                    if (res.data.code === 200) {\n                        let passData = {\n                            title: self.$t(\"m.tip.info\"),\n                            show: true,\n                            content: self.$t(\"m.tip.vehicle_unpair_success\"),\n                            buttonText: {\n                                btnFirst: \"\",\n                                btnSecond: self.$t(\"m.tip.b_ok\")\n                            }\n                        };\n                        self.closeRemind(passData);\n                    }\n                })\n                .catch(function(err) {\n                    if (err) {\n                        let passData = {\n                            title: self.$t(\"m.tip.info\"),\n                            show: true,\n                            content: self.$t(\"m.tip.vehicle_unpair_failed\"),\n                            buttonText: {\n                                btnFirst: \"\",\n                                btnSecond: self.$t(\"m.tip.b_ok\")\n                            }\n                        };\n                        self.closeRemind(passData);\n                    }\n                });\n        },\n        closeRemind(data) {\n            this.showAlerts.show = data.show;\n            this.showAlerts.title = data.title;\n            this.showAlerts.content = data.content;\n            this.showAlerts.buttonText = data.buttonText;\n        },\n        closeBox(type) {\n            //子组件来请求父组件关闭弹窗\n            window.location.reload();\n            if (type && this.curOperation == \"update\") {\n                this.$router.push(\"/inventory/vehicle/list\");\n            } else {\n                this.showAlerts.show = false;\n            }\n        }\n    }\n};\n</script>\n<style lang=\"scss\" scoped>\n.online-box {\n    .online-success {\n        background: #4dbd74;\n        padding: 0 10px;\n        border-radius: 10px;\n        font-weight: bold;\n        color: #ffffff;\n    }\n    .online-danger {\n        background-color: #f86c6b;\n        padding: 0 10px;\n        border-radius: 10px;\n        font-weight: bold;\n        color: #ffffff;\n    }\n    \n}\n.line-height-20 {\n    height: 20vh;\n    line-height: 20vh;\n}\n.car-edit,\n.edit-top {\n    padding-bottom: 20px;\n}\n.price-dorlar {\n    .input-group-text {\n        background: #515b65;\n    }\n}\n.google-maps {\n    cursor: pointer;\n    color: #63c2de;\n\n    i {\n        font-size: 20px;\n    }\n}\n\n.online {\n    background: #f86c6b;\n    padding: 0 10px;\n    border-radius: 10px;\n    font-weight: bold;\n}\n\n.specific-data {\n    border: 1px solid #23282c;\n    border-bottom: none;\n    padding: 10px;\n}\n.sp-box {\n    border-bottom: 1px solid #23282c;\n}\n.right-box {\n    padding: 0 15px 0 50px;\n    margin-top: 30px;\n    .inner-box {\n        height: 500px;\n        position: relative;\n        border: 1px solid #e4e7ea;\n        .right-input-one {\n            position: absolute;\n            left: 50%;\n            top: 50%;\n            transform: translate(-50%, -50%);\n            width: 150px;\n        }\n        .right-p {\n            position: absolute;\n            left: 50%;\n            top: 60%;\n            transform: translate(-50%, -60%);\n        }\n        .right-input-two {\n            position: absolute;\n            left: 50%;\n            top: 50%;\n            transform: translate(-50%, -50%);\n            width: 150px;\n        }\n        i {\n            position: absolute;\n            left: 50%;\n            top: 42%;\n            transform: translate(-50%, -50%);\n        }\n        .i-white {\n            color: #b3bfca;\n            top: 38%;\n        }\n        .i-success {\n            color: #4dbd74;\n        }\n        .i-danger {\n            color: #f86c6b;\n        }\n    }\n}\n.star-red {\n    color: #f86c6b;\n}\n.is-exist {\n    border: 1px solid #f86c6b;\n}\n.is-invalid {\n    border: 1px solid red;\n}\n.button-red {\n    display: inline-block;\n    width: 50px;\n    height: 20px;\n    line-height: 10px;\n    border-radius: 5px;\n    border: none;\n    padding: 0;\n}\n.button-primary {\n    display: inline-block;\n    width: 80px;\n    height: 20px;\n    line-height: 10px;\n    background-color: #63c2de !important;\n    color: #fff;\n    border: none;\n    border-radius: 5px;\n}\n.online-gray {\n        background-color: #c8ced3;\n        padding: 0 10px;\n        border-radius: 10px;\n        color: #23282c;\n        font-weight: bold;\n    }\n</style>\n"]}]}