{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/components/searchMapForGaoDe.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/components/searchMapForGaoDe.vue","mtime":1577095653000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { wgs84ToGcjo2,calCenter } from \"@/utils/coordtransform\";\nimport httpClient from '@/utils/httpclient';\nimport AMap from 'AMap'\nexport default {\n    name: \"SearchMapForGaode\",\n    props: [\"map\", \"from\"],\n    data() {\n        return {\n            mapInfo: {\n                lots:[],\n                lat:0,\n                lng:0,\n                vehicleInfo:[],\n                showMult:true\n            },\n            lat: \"\",\n            lng: \"\",\n            myMap:{},\n            myInfoWindow:null,\n            safeLayer: null,\n            roadLayer: null,\n            source: null\n        }\n    },\n    watch: {\n        map: function (newVal) {\n            this.mapInfo.lots = newVal.lots;\n            this.mapInfo.vehicleInfo = newVal.vehicles;\n            this.getMyMap();\n        },\n        from: function (newVal) {\n            this.source = newVal;\n        }\n    },\n    mounted(){\n        this.getMyMap()\n    },\n    methods: {\n        changeMapType(type) {\n            if (type == 'default') {\n                this.roadLayer.hide();\n                this.safeLayer.hide();\n            } else {\n                this.roadLayer.show();\n                this.safeLayer.show();\n            }\n        },\n        getMyMap(){\n            let centerPoint;\n            let _arr = [];\n            if(this.mapInfo.vehicleInfo.length > 0){\n                this.mapInfo.vehicleInfo.map(item => {\n                    if(item.lastLocationLat && item.lastLocationLng ){\n                        _arr.push({\n                            lng: item.lastLocationLng,\n                            lat: item.lastLocationLat\n                        })\n                    }\n                });\n                centerPoint = calCenter(_arr);\n            }\n\n            this.myMap = new AMap.Map(\"gaode-map\", {//实例化一个地图\n                zoom: 12,\n                viewMode: '3D',\n                center: centerPoint\n            });\n            this.roadLayer = new AMap.TileLayer.RoadNet({\n            });\n            this.myMap.addControl(new AMap.ControlBar());\n            this.myMap.addControl(new AMap.Scale({\n                visible: true\n            }));\n            this.myMap.add(this.roadLayer);\n            let area2 = [];\n            if(this.mapInfo.lots.length > 0){\n                this.mapInfo.lots.map(item => {//给地图加上指定停车红色区域\n                    let myArr=[];\n                    item.areaCoordinate.map(val =>{\n                        let temp = val.split(\",\");\n                        myArr.push(wgs84ToGcjo2(Number(temp[0]), Number(temp[1]) ))\n                    });\n                    area2.push(myArr)\n                });\n            }\n\n            let polygon = new AMap.Polygon({//给地图加上指定停车红色区域\n                path: area2,\n                strokeColor: '#FF0000',\n                strokeOpacity: 0.8,\n                strokeWeight: 2,\n                fillColor: '#FF0000',\n                fillOpacity: 0.35\n            });\n            this.myMap.add(polygon);\n            this.myInfoWindow = new AMap.InfoWindow({offset: new AMap.Pixel(0, 0)});//初始化地图infoWindow\n            if (this.mapInfo.showMult) {\n                this.mapInfo.vehicleInfo.map(item => {\n                    if(item.lastLocationLat && item.lastLocationLng ){\n                        this.addMarkers(item);\n                    }\n                })\n                this.myMap.setFitView();\n            }\n            this.myMap.setFitView();\n        },\n\n        addMarkers(item){\n            console.log(item)\n            let lnglat = wgs84ToGcjo2(item.lastLocationLng, item.lastLocationLat);\n            let marker = new AMap.Marker({\n                position: lnglat,\n                map: this.myMap,\n                icon: new AMap.Icon({\n                    image: item.currentVoltage && item.currentVoltage.toFixed(1) < 11.7 ? \"https://cdn2.shopify.com/s/files/1/0703/1149/files/Location_03580bd1-f466-4803-a69e-720a098b08a5.svg?828688\" : \"https://pic.zus.ai/saas/vehicle_normal.svg\",\n                    size: new AMap.Size(20, 30),\n                    imageSize: new AMap.Size(20,30),\n                })\n            });\n            marker.content = '';\n            marker.item = item;\n            marker.on('click', this.markerClick);\n        },\n\n        markerClick(e) {//地图标记点击事件\n            let lang='';\n            if(this.$i18n.locale === 'zh-CN'){\n                lang = 'China'\n            }else{\n                lang = 'US'\n            }\n            let item = e.target.item;\n            let link = '/api/v1/getlastLocation?lastlocationlat='+item.lastLocationLat+'&lastlocationlng='+item.lastLocationLng+'&country='+lang;\n            httpClient.get(link).then(res=>{\n                if(res.data.code === 200){\n                    let p = item.currentVoltage < 11.7 ? `<p style=\"margin-bottom:6px;font-size: 12px;\">${ this.$t('m.common.voltage') }: <span style=\"color:red\"><i class=\"fa fa-exclamation-triangle\"></i>${item.currentVoltage ? item.currentVoltage.toFixed(1) + 'V' : ''}</span></p>` :`<p style=\"margin-bottom:6px;font-size: 12px;\">${ this.$t('m.common.voltage') }:${ item.currentVoltage ?  item.currentVoltage.toFixed(1) + 'V' : ''}</p>`;\n                    let img = item.photoUrl ?  `<img style=\"background: #3a4149\" src=\"${ item.photoUrl }\" width=\"100%\" alt=\"\">` : ''\n                    let contentString = `<div>\n                        ${img}\n                        <a target=\"_blank\" href='${item.saleStatus === 1 ?\"/inventory/vehicle\":\"/sold-manager/sold-vehicle\"}/detail/${item.vehicleId}'><h5 id=\"firstHeading\" class=\"firstHeading\">${item.year ? item.year :'N/A'} ${item.make ? item.make :'N/A'} ${item.model ? item.model:'N/A'} ${item.alias? \"-\" + item.alias:''}</h5></a>\n                        <p style=\"margin-bottom:6px;font-size: 12px\">VIN:${item.vin}</p>\n                        ${p}\n                        <p style=\"margin-bottom:6px;font-size: 12px\">${this.$t('m.common.last_location')}:${res.data.data.locationName}</p>\n                        <p style=\"margin-bottom:6px;font-size: 12px\">${this.$t('m.common.last_update')}:${this.getYMDString(item.locationTime)}</p>\n                        </div>`;\n                    this.myInfoWindow.setContent(contentString);\n                    this.myInfoWindow.open(this.myMap, e.target.getPosition());\n                }\n            })\n\n        },\n        getYMDString(time) {//格式化时间\n            if(time){\n                var date = new Date(time);\n                var Y = date.getFullYear() + ' ';\n                var M = (date.getMonth() + 1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1);\n                var D = date.getDate() < 10 ? '0' + date.getDate() : date.getDate() ;\n                var h = date.getHours() < 10 ? '0' + date.getHours() : date.getHours() ;\n                var m = date.getMinutes() < 10 ? '0' + date.getMinutes()  : date.getMinutes();\n                return  M + '/' + D + '/' + Y + ' ' + h +':'+ m +  ' ';\n            }else{\n                return  '';\n            }\n        },\n    }\n}\n",{"version":3,"sources":["searchMapForGaoDe.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"searchMapForGaoDe.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div class=\"searchGaode\">\n        <div class=\"map-btn-group\">\n            <ul>\n                <li @click=\"changeMapType('default')\">地图 |</li>\n                <li @click=\"changeMapType('sate')\">&nbsp;卫星图像</li>\n            </ul>\n        </div>\n        <div class=\"amap\" id=\"gaode-map\">\n\n        </div>\n    </div>\n</template>\n\n<script>\n    import { wgs84ToGcjo2,calCenter } from \"@/utils/coordtransform\";\n    import httpClient from '@/utils/httpclient';\n    import AMap from 'AMap'\n    export default {\n        name: \"SearchMapForGaode\",\n        props: [\"map\", \"from\"],\n        data() {\n            return {\n                mapInfo: {\n                    lots:[],\n                    lat:0,\n                    lng:0,\n                    vehicleInfo:[],\n                    showMult:true\n                },\n                lat: \"\",\n                lng: \"\",\n                myMap:{},\n                myInfoWindow:null,\n                safeLayer: null,\n                roadLayer: null,\n                source: null\n            }\n        },\n        watch: {\n            map: function (newVal) {\n                this.mapInfo.lots = newVal.lots;\n                this.mapInfo.vehicleInfo = newVal.vehicles;\n                this.getMyMap();\n            },\n            from: function (newVal) {\n                this.source = newVal;\n            }\n        },\n        mounted(){\n            this.getMyMap()\n        },\n        methods: {\n            changeMapType(type) {\n                if (type == 'default') {\n                    this.roadLayer.hide();\n                    this.safeLayer.hide();\n                } else {\n                    this.roadLayer.show();\n                    this.safeLayer.show();\n                }\n            },\n            getMyMap(){\n                let centerPoint;\n                let _arr = [];\n                if(this.mapInfo.vehicleInfo.length > 0){\n                    this.mapInfo.vehicleInfo.map(item => {\n                        if(item.lastLocationLat && item.lastLocationLng ){\n                            _arr.push({\n                                lng: item.lastLocationLng,\n                                lat: item.lastLocationLat\n                            })\n                        }\n                    });\n                    centerPoint = calCenter(_arr);\n                }\n\n                this.myMap = new AMap.Map(\"gaode-map\", {//实例化一个地图\n                    zoom: 12,\n                    viewMode: '3D',\n                    center: centerPoint\n                });\n                this.roadLayer = new AMap.TileLayer.RoadNet({\n                });\n                this.myMap.addControl(new AMap.ControlBar());\n                this.myMap.addControl(new AMap.Scale({\n                    visible: true\n                }));\n                this.myMap.add(this.roadLayer);\n                let area2 = [];\n                if(this.mapInfo.lots.length > 0){\n                    this.mapInfo.lots.map(item => {//给地图加上指定停车红色区域\n                        let myArr=[];\n                        item.areaCoordinate.map(val =>{\n                            let temp = val.split(\",\");\n                            myArr.push(wgs84ToGcjo2(Number(temp[0]), Number(temp[1]) ))\n                        });\n                        area2.push(myArr)\n                    });\n                }\n\n                let polygon = new AMap.Polygon({//给地图加上指定停车红色区域\n                    path: area2,\n                    strokeColor: '#FF0000',\n                    strokeOpacity: 0.8,\n                    strokeWeight: 2,\n                    fillColor: '#FF0000',\n                    fillOpacity: 0.35\n                });\n                this.myMap.add(polygon);\n                this.myInfoWindow = new AMap.InfoWindow({offset: new AMap.Pixel(0, 0)});//初始化地图infoWindow\n                if (this.mapInfo.showMult) {\n                    this.mapInfo.vehicleInfo.map(item => {\n                        if(item.lastLocationLat && item.lastLocationLng ){\n                            this.addMarkers(item);\n                        }\n                    })\n                    this.myMap.setFitView();\n                }\n                this.myMap.setFitView();\n            },\n\n            addMarkers(item){\n                console.log(item)\n                let lnglat = wgs84ToGcjo2(item.lastLocationLng, item.lastLocationLat);\n                let marker = new AMap.Marker({\n                    position: lnglat,\n                    map: this.myMap,\n                    icon: new AMap.Icon({\n                        image: item.currentVoltage && item.currentVoltage.toFixed(1) < 11.7 ? \"https://cdn2.shopify.com/s/files/1/0703/1149/files/Location_03580bd1-f466-4803-a69e-720a098b08a5.svg?828688\" : \"https://pic.zus.ai/saas/vehicle_normal.svg\",\n                        size: new AMap.Size(20, 30),\n                        imageSize: new AMap.Size(20,30),\n                    })\n                });\n                marker.content = '';\n                marker.item = item;\n                marker.on('click', this.markerClick);\n            },\n\n            markerClick(e) {//地图标记点击事件\n                let lang='';\n                if(this.$i18n.locale === 'zh-CN'){\n                    lang = 'China'\n                }else{\n                    lang = 'US'\n                }\n                let item = e.target.item;\n                let link = '/api/v1/getlastLocation?lastlocationlat='+item.lastLocationLat+'&lastlocationlng='+item.lastLocationLng+'&country='+lang;\n                httpClient.get(link).then(res=>{\n                    if(res.data.code === 200){\n                        let p = item.currentVoltage < 11.7 ? `<p style=\"margin-bottom:6px;font-size: 12px;\">${ this.$t('m.common.voltage') }: <span style=\"color:red\"><i class=\"fa fa-exclamation-triangle\"></i>${item.currentVoltage ? item.currentVoltage.toFixed(1) + 'V' : ''}</span></p>` :`<p style=\"margin-bottom:6px;font-size: 12px;\">${ this.$t('m.common.voltage') }:${ item.currentVoltage ?  item.currentVoltage.toFixed(1) + 'V' : ''}</p>`;\n                        let img = item.photoUrl ?  `<img style=\"background: #3a4149\" src=\"${ item.photoUrl }\" width=\"100%\" alt=\"\">` : ''\n                        let contentString = `<div>\n                            ${img}\n                            <a target=\"_blank\" href='${item.saleStatus === 1 ?\"/inventory/vehicle\":\"/sold-manager/sold-vehicle\"}/detail/${item.vehicleId}'><h5 id=\"firstHeading\" class=\"firstHeading\">${item.year ? item.year :'N/A'} ${item.make ? item.make :'N/A'} ${item.model ? item.model:'N/A'} ${item.alias? \"-\" + item.alias:''}</h5></a>\n                            <p style=\"margin-bottom:6px;font-size: 12px\">VIN:${item.vin}</p>\n                            ${p}\n                            <p style=\"margin-bottom:6px;font-size: 12px\">${this.$t('m.common.last_location')}:${res.data.data.locationName}</p>\n                            <p style=\"margin-bottom:6px;font-size: 12px\">${this.$t('m.common.last_update')}:${this.getYMDString(item.locationTime)}</p>\n                            </div>`;\n                        this.myInfoWindow.setContent(contentString);\n                        this.myInfoWindow.open(this.myMap, e.target.getPosition());\n                    }\n                })\n\n            },\n            getYMDString(time) {//格式化时间\n                if(time){\n                    var date = new Date(time);\n                    var Y = date.getFullYear() + ' ';\n                    var M = (date.getMonth() + 1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1);\n                    var D = date.getDate() < 10 ? '0' + date.getDate() : date.getDate() ;\n                    var h = date.getHours() < 10 ? '0' + date.getHours() : date.getHours() ;\n                    var m = date.getMinutes() < 10 ? '0' + date.getMinutes()  : date.getMinutes();\n                    return  M + '/' + D + '/' + Y + ' ' + h +':'+ m +  ' ';\n                }else{\n                    return  '';\n                }\n            },\n        }\n    }\n</script>\n\n<style lang=\"scss\" scoped>\n    .searchGaode {\n        #gaode-map {\n            width: 100%;\n            height: 65vh;\n            margin-bottom: 5vh;\n            .amap-info-contentContainer {\n                width: 100%;\n                border-radius: 10px;\n                .amap-info-content{\n                    padding: 20px 10px 0;\n                }\n                .amap-info-close{\n                    right:10px !important;\n                }\n            }\n            .amap-info-shadowContainer + div {\n                bottom: 30px!important;\n            }\n        }\n        .map-btn-group {\n            position: absolute;\n            margin-top: 10px;\n            z-index: 1;\n            margin-left: 20px;\n            ul {\n                color: grey;\n                padding: 0 20px;\n                height: 40px;\n                line-height: 40px;\n                background: #ffffff;\n                font-size: 18px;\n                li {\n                    cursor: pointer;\n                    display: inline-block;\n                }\n            }\n        }\n        .content-window-card {\n            position: relative;\n            box-shadow: none;\n            bottom: 0;\n            left: 0;\n            width: auto;\n            padding: 0;\n        }\n\n        .content-window-card p {\n            height: 2rem;\n        }\n\n        .custom-info {\n            border: solid 1px silver;\n        }\n\n        div.info-top {\n            position: relative;\n            background: none repeat scroll 0 0 #F9F9F9;\n            border-bottom: 1px solid #CCC;\n            border-radius: 5px 5px 0 0;\n        }\n\n        div.info-top div {\n            display: inline-block;\n            color: #333333;\n            font-size: 14px;\n            font-weight: bold;\n            line-height: 31px;\n            padding: 0 10px;\n        }\n\n        div.info-top img {\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            transition-duration: 0.25s;\n        }\n\n        div.info-top img:hover {\n            box-shadow: 0px 0px 5px #000;\n        }\n\n        div.info-middle {\n            font-size: 12px;\n            padding: 10px 6px;\n            line-height: 20px;\n        }\n\n        div.info-bottom {\n            height: 0px;\n            width: 100%;\n            clear: both;\n            text-align: center;\n        }\n\n        div.info-bottom img {\n            position: relative;\n            z-index: 104;\n        }\n\n        span {\n            margin-left: 5px;\n            font-size: 11px;\n        }\n\n        .info-middle img {\n            float: left;\n            margin-right: 6px;\n        }\n    }\n\n</style>\n"]}]}