{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/vehicleEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/vehicleEdit.vue","mtime":1559546167000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n  import {getDateString,getYMDString} from '@/utils/date';\n\timport httpClient from '@/utils/httpclient';\n\timport googleMap from '@components/googleMap'\n  import Alert from '@components/model'\n\texport default {\n\t\tname: 'edit',\n\t\tcomponents:{\n\t\t\tgoogleMap,Alert\n    },\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tid: this.$router.currentRoute.params.id,\n\t\t\t\timage: '',\n        year:'',\n        lot:'',\n\t\t\t\tvin: '',\n        priceUnit:'',\n        iMei:'',\n        price:'',\n        make:'',\n        color:'',\n\t\t\t\tOdometer:'',\n        modal:'',\n        trim:'',\n        isOnline:'',\n\t\t\t\tlastUpdateTime:'',\n\t\t\t\tlastLocation:'',\n\t\t\t\tengineType:'',\n\t\t\t\tstockNumber:'',\n\t\t\t\tplateNumber:'',\n\t\t\t\tinventoryDate:'',\n\t\t\t\tcondition:'',\n\t\t\t\tinventoryTime:'',\n\t\t\t\tcurrentMileage:'',\n\t\t\t\tselectedOption:'',\n\t\t\t\tselectedCondition:'',\n\t\t\t\tfile: \"\",\n\t\t\t\tboxOne: '',\n\t\t\t\tlastLocationLat:'',\n\t\t\t\tshowAlerts:{\n\t\t\t\t\ttitle:'',\n          show:false,\n          content:'',\n\t\t\t\t\tbuttonText:''\n        },\n        colorList:['Black','White','Silver','Blue','Red','Brown','Gold','Orange','Yellow','Purple','Green','Pink','Others'],\n        conditionList:['New','Used','Demo'],\n\t\t\t\tmap:{},\n\t\t\t\timgData: {\n\t\t\t\t\taccept: \"image/gif, image/jpeg, image/png, image/jpg\"\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\n\t\tmounted() {//初始化各项数据\n\t\t\tlet that = this;\n\t\t\tlet url = 'https://api-saas-qa.zus.ai/api/v1/vehicle/detail/id?vehicleId=' + that.id;\n\t\t\thttpClient.get(url).then((res) => {\n\t\t\t\tlet myData = res.data.data;\n\t\t\t\tthat.image = myData.photoPath;\n\t\t\t\tthat.year = myData.year;\n\t\t\t\tthat.vin = myData.vin;\n\t\t\t\tthat.inventoryTime = myData.inventoryTime;\n\t\t\t\tthat.currentMileage = myData.currentMileage;\n\t\t\t\tthat.lot = myData.parkingLot;\n\t\t\t\tthat.iMei = myData.deviceMac;\n\t\t\t\tthat.price = myData.price;\n\t\t\t\tthat.priceUnit = myData.priceUnit;\n\t\t\t\tthat.color = myData.color;\n\t\t\t\tthat.Odometer = Math.round(myData.currentMileage * 0.0006214);\n\t\t\t\tthat.make = myData.make;\n\t\t\t\tthat.lastLocationLat = myData.lastLocationLat;\n\t\t\t\tthat.modal = myData.model;\n\t\t\t\tthat.trim = myData.trim;\n\t\t\t\tthat.engineType = myData.engineType;\n\t\t\t\tthat.condition = myData.vehicleType;\n\t\t\t\tthat.stockNumber = myData.stockNumber;\n\t\t\t\tthat.plateNumber = myData.plate;\n\t\t\t\tlet _i = that.colorList.findIndex((val)=> val === that.color);\n\t\t\t\tthat.selectedOption = that.colorList[_i];\n\t\t\t\tlet _j = that.conditionList.findIndex((val)=> val === that.condition);\n\t\t\t\tthat.selectedCondition = that.conditionList[_j];\n\t\t\t\tthat.lastLocation = myData.lastLocation;\n\t\t\t\tthat.isOnline = myData.adapter === 'Online' ? 'Online' :'Offline';\n\t\t\t\tmyData.lastUpdateTime !== null ? that.lastUpdateTime = getDateString(myData.lastUpdateTime) : that.lastUpdateTime = 'N/A';\n\t\t\t\tmyData.inventoryTime !== null ? that.inventoryDate = getYMDString(myData.inventoryTime) : '';\n\t\t\t\tthat.map = {\n\t\t\t\t\tlat: myData.lastLocationLat === null ? '' : myData.lastLocationLat,\n\t\t\t\t\tlng: myData.lastLocationLng === null ? '' : myData.lastLocationLng,\n\t\t\t\t\tarea: myData.areaCoordinates === null ? '' : myData.areaCoordinates,\n\t\t\t\t\tvehicleInfo: 'info'\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\tmethods: {\n\t\t\tgetFile(event) {//图片上传\n\t\t\t\tthis.file = event.target.files[0];\n\t\t\t\tlet formData = new FormData();\n\t\t\t\tformData.append(\"file\", this.file); //‘file’是後台接收文件名\n\t\t\t\tlet config = {\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"multipart/form-data\"\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tlet self = this;\n\t\t\t\thttpClient.post(\"https://api-saas-qa.zus.ai/api/v1/uploadFile\", formData, config)\n\t\t\t\t\t.then(function(res) {\n\t\t\t\t\t\tif(res.data.code === 200){\n\t\t\t\t\t\t\tlet passData = {\n\t\t\t\t\t\t\t\ttitle:'Photo Upload',\n\t\t\t\t\t\t\t\tshow:true,\n\t\t\t\t\t\t\t\tcontent:'Photo Uploaded Successfully',\n\t\t\t\t\t\t\t\tbuttonText:{\n\t\t\t\t\t\t\t\t\tbtnFirst:'',\n\t\t\t\t\t\t\t\t\tbtnSecond:'OK'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tself.closeRemind(passData);\n            }\n\t\t\t\t\t\tself.image = res.data.data.path;\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tif(err){\n\t\t\t\t\t\t\tlet passData = {\n\t\t\t\t\t\t\t\ttitle:'Photo Upload',\n\t\t\t\t\t\t\t\tshow:true,\n\t\t\t\t\t\t\t\tcontent:'Photo Upload Failed',\n\t\t\t\t\t\t\t\tbuttonText:{\n\t\t\t\t\t\t\t\t\tbtnFirst:'',\n\t\t\t\t\t\t\t\t\tbtnSecond:'OK'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tself.closeRemind(passData);\n            }\n\t\t\t\t});\n\t\t\t},\n      saveData(){//设备参数更新，保存\n\t\t\t\tlet carType = this.selectedCondition;\n\t\t\t\tif(carType === 'New'){\n\t\t\t\t\tcarType = 1;\n        }else if(carType === 'Used'){\n\t\t\t\t\tcarType = 3;\n        }else{\n\t\t\t\t\tcarType = 2;\n        }\n\t\t\t\tfunction convertDateToTime(strtime) {\n\t\t\t\t\tvar date = new Date(strtime);\n\t\t\t\t\treturn date.getTime();\n\t\t\t\t}\n\t\t\t\tfunction isInteger(obj) {\n\t\t\t\t\treturn typeof obj === 'number' && obj%1 === 0\n\t\t\t\t}\n\n\t\t\t\tlet _time = convertDateToTime(this.inventoryDate);\n\t\t\t\tlet dataTime;\n\t\t\t\tif(_time && isInteger(_time)){\n\t\t\t\t\tdataTime = _time\n        }\n\n\t\t\t\tlet _data = {\n\t\t\t\t\tcolor:this.selectedOption,\n\t\t\t\t\tcurrentMileage:parseInt(this.currentMileage) > 0 ? this.currentMileage*1609.344 :null,\n\t\t\t\t\tengineType:this.engineType,\n\t\t\t\t\tid: this.$router.currentRoute.params.id,\n\t\t\t\t\tinventoryTime: dataTime,\n\t\t\t\t\tmake:this.make,\n\t\t\t\t\tmodel:this.modal,\n\t\t\t\t\tphotoPath: this.image,\n\t\t\t\t\tplat:this.plateNumber,\n\t\t\t\t\tprice:this.price,\n\t\t\t\t\tstockNumber:this.stockNumber,\n\t\t\t\t\ttrim:this.trim,\n\t\t\t\t\tvehicleType:carType,\n\t\t\t\t\tyear:this.year,\n        };\n\n\t\t\t\tlet link = \"https://api-saas-qa.zus.ai/api/v1/vehicle/update\";\n\t\t\t\tlet self = this;\n\t\t\t\thttpClient.post(link, _data).then(function (res) {\n          if(res.data.data && res.data.data.result){\n\t\t\t\t\t\tlet passData = {\n\t\t\t\t\t\t\ttitle:'Vehicle Update',\n              show:true,\n              content:'Success!',\n              buttonText:{\n\t\t\t\t\t\t\t\tbtnFirst:'',\n                btnSecond:'OK'\n              }\n            };\n\t\t\t\t\t\tself.closeRemind(passData);\n          }\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tif(err){\n\t\t\t\t\t\t\tlet passData = {\n\t\t\t\t\t\t\t\ttitle:'Vehicle Update',\n\t\t\t\t\t\t\t\tshow:true,\n\t\t\t\t\t\t\t\tcontent:'Failed!',\n\t\t\t\t\t\t\t\tbuttonText:{\n\t\t\t\t\t\t\t\t\tbtnFirst:'',\n\t\t\t\t\t\t\t\t\tbtnSecond:'OK'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tself.closeRemind(passData);\n            }\n\t\t\t\t\t});\n      },\n      unPairdevice(){//设备解绑，未绑定的设备，按钮不显示\n\t\t\t\tlet link = '/api/v1/vehicle/bind/device';\n\t\t\t\tlet self = this;\n\t\t\t\tlet data = {\n\t\t\t\t\tdeviceMac:this.iMei,\n          vin:this.vin\n        };\n\t\t\t\thttpClient.post(link, data).then(function (res) {\n\t\t\t\t\tif(res.data.code === 200) {\n\t\t\t\t\t\tlet passData = {\n\t\t\t\t\t\t\ttitle: 'Vehicle Unpair',\n\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\tcontent: 'Success!',\n\t\t\t\t\t\t\tbuttonText: {\n\t\t\t\t\t\t\t\tbtnFirst: '',\n\t\t\t\t\t\t\t\tbtnSecond: 'OK'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tself.closeRemind(passData);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\tif(err){\n\t\t\t\t\t\tlet passData = {\n\t\t\t\t\t\t\ttitle: 'Vehicle Unpair',\n\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\tcontent: 'Failed!',\n\t\t\t\t\t\t\tbuttonText: {\n\t\t\t\t\t\t\t\tbtnFirst: '',\n\t\t\t\t\t\t\t\tbtnSecond: 'OK'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tself.closeRemind(passData);\n          }\n\t\t\t\t});\n      },\n\t\t\tcloseRemind(data){\n\t\t\t\tthis.showAlerts.show = data.show;\n\t\t\t\tthis.showAlerts.title = data.title;\n\t\t\t\tthis.showAlerts.content = data.content;\n\t\t\t\tthis.showAlerts.buttonText = data.buttonText;\n      },\n\t\t\tcloseBox(){//子组件来请求父组件关闭弹窗\n\t\t\t\tthis.showAlerts.show = !this.showAlerts.show;\n      }\n    }\n\t}\n",null]}