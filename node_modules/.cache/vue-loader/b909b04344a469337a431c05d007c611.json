{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/vehicleEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/vehicleEdit.vue","mtime":1570782006000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {getDateString, getYMDString} from '@/utils/date';\nimport httpClient from '@/utils/httpclient';\nimport myMap from '@components/map'\nimport Alert from '@components/model'\n\nexport default {\n    name: 'edit',\n    components: {\n        myMap, Alert\n    },\n    data() {\n        return {\n            id: this.$router.currentRoute.params.id,\n            showMap: false,\n            image: '',\n            year: '',\n            lot: '',\n            vin: '',\n            priceUnit: '',\n            iMei: '',\n            price: '',\n            make: '',\n            alias:'',\n            color: '',\n            Odometer: '',\n            modal: '',\n            trim: '',\n            isOnline: '',\n            lastUpdateTime: '',\n            lastLocation: '',\n            engineType: '',\n            stockNumber: '',\n            plateNumber: '',\n            inventoryDate: '',\n            condition: '',\n            inventoryTime: '',\n            currentMileage: '',\n            selectedOption: '',\n            selectedCondition: '',\n            file: \"\",\n            boxOne: '',\n            lastLocationLat: '',\n            showAlerts: {\n                title: '',\n                show: false,\n                content: '',\n                buttonText: ''\n            },\n            colorList: [{c: this.$t('m.colors.black'), y: \"Black\"}, {c: this.$t('m.colors.white'), y:'White'}, {c: this.$t('m.colors.silver'), y: 'Silver'}, {c: this.$t('m.colors.blue'), y: 'Blue'}, {c: this.$t('m.colors.red'), y: 'Red'}, {c: this.$t('m.colors.brown'), y: 'Brown'}, {c: this.$t('m.colors.gold'), y: 'Gold'}, {c: this.$t('m.colors.orange'), y: 'Orange'}, {c: this.$t('m.colors.yellow'), y: 'Yellow'}, {c: this.$t('m.colors.purple'), y: 'Purple'}, {c: this.$t('m.colors.green'), y: 'Green'}, {c: this.$t('m.colors.pink'), y: 'Pink'},{c: this.$t('m.colors.others'), y: 'Others'}],\n            conditionList: [{c: this.$t('m.common.c_new'), y: \"1\"}, { c: this.$t('m.common.c_used'), y: \"3\"}, { c: this.$t('m.common.c_demo'), y: \"2\" }, {c: this.$t('m.common.c_test'), y: \"4\"}],\n            map: {},\n            changedLanguage:false\n        }\n    },\n\n    mounted() {//初始化各项数据\n        if (this.$i18n.locale === 'en-US') {\n            this.changedLanguage = \"English\";\n        } else {\n            this.changedLanguage = 'Chinese';\n        }\n\n        let that = this;\n        let url = '/api/v1/vehicle/detail/id?vehicleId=' + that.id;\n        httpClient.get(url).then((res) => {\n            let myData = res.data.data;\n            that.image = myData.photoPath ? myData.photoPath : require('@/assets/pages-img/placeholder.svg');\n            that.year = myData.year;\n            that.vin = myData.vin;\n            that.inventoryTime = myData.inventoryTime;\n\n            let _mileage = null;//距离单位转换\n            if(myData.currentMileage){\n                if(that.changedLanguage === 'English'){\n                    _mileage = ((myData.currentMileage * 0.0006214).toFixed(0))\n                }else{\n                    _mileage = ((myData.currentMileage / 1000).toFixed(0))\n                }\n            }else{\n                _mileage = 'N/A'\n            }\n\n            that.currentMileage = _mileage;\n            that.lot = myData.parkingLot;\n            that.iMei = myData.deviceMac;\n            that.price = myData.price;\n            that.priceUnit = that.$t('m.common.moneyType');\n            that.color = myData.color;\n            that.Odometer = _mileage;\n            that.make = myData.make;\n            that.alias = myData.alias;\n            that.lastLocationLat = myData.lastLocationLat;\n            that.modal = myData.model;\n            that.trim = myData.trim;\n            that.engineType = myData.engineType;\n            that.condition = myData.vehicleType;\n            that.stockNumber = myData.stockNumber;\n            that.plateNumber = myData.plate;\n            that.selectedOption = myData.color;\n            that.selectedCondition = myData.vehicleTypeCode;\n            that.lastLocation = myData.lastLocation;\n            that.isOnline = myData.isOnline == 1 ? this.$t('m.common.online') : (myData.isOnline == 3 ? 'N/A' : this.$t('m.common.offline')) ;\n            myData.lastUpdateTime !== null ? that.lastUpdateTime = getDateString(myData.lastUpdateTime) : that.lastUpdateTime = 'N/A';\n            myData.inventoryTime !== null ? that.inventoryDate = getYMDString(myData.inventoryTime) : '';\n            that.map = {\n                lat: myData.lastLocationLat === null ? 0 : myData.lastLocationLat,\n                lng: myData.lastLocationLng === null ? 0 : myData.lastLocationLng,\n                area: myData.areaCoordinates === null ? [] : myData.areaCoordinates,\n                vehicleInfo: 'info'\n            };\n        });\n    },\n    methods: {\n        format_number(nStr) {\n            nStr += '';\n            let x = nStr.split('.');\n            let x1 = x[0];\n            let x2 = x.length > 1 ? '.' + x[1] : '';\n            var rgx = /(\\d+)(\\d{3})/;\n            while (rgx.test(x1)) {\n                x1 = x1.replace(rgx, '$1' + ',' + '$2');\n            }\n            return x1 + x2;\n        },\n        showMapTip() {\n            if (this.map.lat || this.map.area.length > 0) {\n                this.showMap = true;\n            }\n        },\n        getFile(event) {//图片上传\n            this.file = event.target.files[0];\n            let formData = new FormData();\n            formData.append(\"file\", this.file); //‘file’是後台接收文件名\n            let config = {\n                headers: {\n                    \"Content-Type\": \"multipart/form-data\"\n                }\n            };\n            let self = this;\n            httpClient.post(\"/api/v1/uploadFile\", formData, config)\n                .then(function (res) {\n                    if (res.data.code === 200) {\n                        let passData = {\n                            title: self.$t('m.tip.info'),\n                            show: true,\n                            content: self.$t('m.tip.upload'),\n                            buttonText: {\n                                btnFirst: self.$t('m.tip.b_cancel'),\n                                btnSecond: ''\n                            }\n                        };\n                        self.closeRemind(passData);\n                    }\n                    self.image = res.data.data.path;\n                }).catch(function (err) {\n                if (err) {\n                    let passData = {\n                        title: self.$t('m.tip.info'),\n                        show: true,\n                        content: self.$t('m.tip.upload_failed'),\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: self.$t('m.tip.b_ok'),\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            });\n        },\n        saveData() {//设备参数更新，保存\n\n            function convertDateToTime(strtime) {\n                var date = new Date(strtime);\n                return date.getTime();\n            }\n\n            function isInteger(obj) {\n                return typeof obj === 'number' && obj % 1 === 0\n            }\n\n            let _time = convertDateToTime(this.inventoryDate);\n            let dataTime;\n            if (_time && isInteger(_time)) {\n                dataTime = _time\n            }\n\n\n            let _mileage= null;\n            if(this.Odometer){\n                if(this.changedLanguage === 'English'){\n                    _mileage = ((this.Odometer / 0.0006214).toFixed(0))\n                }else{\n                    _mileage = ((this.Odometer * 1000).toFixed(0))\n                }\n            }else{\n                _mileage = 0\n            }\n\n            let _data = {\n                color: this.selectedOption,\n                currentMileage: _mileage,\n                engineType: this.engineType,\n                id: this.$router.currentRoute.params.id,\n                inventoryTime: dataTime,\n                make: this.make,\n                model: this.modal,\n                alias: this.alias,\n                photoPath: this.image,\n                plat: this.plateNumber,\n                price: this.price,\n                stockNumber: this.stockNumber,\n                trim: this.trim,\n                vehicleTypeCode: this.selectedCondition,\n                year: this.year,\n            };\n\n            let link = \"/api/v1/vehicle/update\";\n            let self = this;\n            httpClient.post(link, _data).then(function (res) {\n                if (res.data.data && res.data.data.result) {\n                    let passData = {\n                        title: self.$t('m.tip.info'),\n                        show: true,\n                        content: self.$t('m.tip.vehicle_upsucc'),\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: self.$t('m.tip.b_ok'),\n                            origin:'save'\n                        },\n                    };\n                    self.closeRemind(passData);\n                }\n            }).catch(function (err) {\n                if (err) {\n                    let passData = {\n                        title: self.$t('m.tip.info'),\n                        show: true,\n                        content: self.$t('m.tip.vehicle_upfail'),\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: self.$t('m.tip.b_ok'),\n                            origin:'save'\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            });\n        },\n        unPairdevice() {//设备解绑，未绑定的设备，按钮不显示\n            let link = '/api/v1/vehicle/unbind/device';\n            let self = this;\n            let data = {\n                deviceMac: this.iMei,\n                vin: this.vin\n            };\n            httpClient.post(link, data).then(function (res) {\n                if (res.data.code === 200) {\n                    let passData = {\n                        title: self.$t('m.tip.info'),\n                        show: true,\n                        content: self.$t('m.tip.vehicle_unpair_success'),\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: self.$t('m.tip.b_ok')\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            }).catch(function (err) {\n                if (err) {\n                    let passData = {\n                        title: self.$t('m.tip.info'),\n                        show: true,\n                        content: self.$t('m.tip.vehicle_unpair_failed'),\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: self.$t('m.tip.b_ok')\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            });\n        },\n        closeRemind(data) {\n            this.showAlerts.show = data.show;\n            this.showAlerts.title = data.title;\n            this.showAlerts.content = data.content;\n            this.showAlerts.buttonText = data.buttonText;\n        },\n        closeBox(type) {//子组件来请求父组件关闭弹窗\n            if(type){\n                this.$router.push('/inventory/vehicle')\n            } else {\n                this.showAlerts.show = false;\n            }\n        }\n    }\n}\n",null]}