{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/vehicleEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/vehicleEdit.vue","mtime":1561521099000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {getDateString, getYMDString} from '@/utils/date';\nimport httpClient from '@/utils/httpclient';\nimport googleMap from '@components/googleMap'\nimport Alert from '@components/model'\n\nexport default {\n    name: 'edit',\n    components: {\n        googleMap, Alert\n    },\n    data() {\n        return {\n            id: this.$router.currentRoute.params.id,\n            showMap: false,\n            image: '',\n            year: '',\n            lot: '',\n            vin: '',\n            priceUnit: '',\n            iMei: '',\n            price: '',\n            make: '',\n            color: '',\n            Odometer: '',\n            modal: '',\n            trim: '',\n            isOnline: '',\n            lastUpdateTime: '',\n            lastLocation: '',\n            engineType: '',\n            stockNumber: '',\n            plateNumber: '',\n            inventoryDate: '',\n            condition: '',\n            inventoryTime: '',\n            currentMileage: '',\n            selectedOption: '',\n            selectedCondition: '',\n            file: \"\",\n            boxOne: '',\n            lastLocationLat: '',\n            showAlerts: {\n                title: '',\n                show: false,\n                content: '',\n                buttonText: ''\n            },\n            colorList: ['Black', 'White', 'Silver', 'Blue', 'Red', 'Brown', 'Gold', 'Orange', 'Yellow', 'Purple', 'Green', 'Pink', 'Others'],\n            conditionList: ['New', 'Used', 'Demo'],\n            map: {},\n            imgData: {\n                accept: \"image/gif, image/jpeg, image/png, image/jpg\"\n            },\n        }\n    },\n\n    mounted() {//初始化各项数据\n        let that = this;\n        let url = '/api/v1/vehicle/detail/id?vehicleId=' + that.id;\n        httpClient.get(url).then((res) => {\n            console.log(res);\n            let myData = res.data.data;\n            that.image = myData.photoPath;\n            that.year = myData.year;\n            that.vin = myData.vin;\n            that.inventoryTime = myData.inventoryTime;\n            that.currentMileage = Math.round(myData.currentMileage * 0.0006214);\n            that.lot = myData.parkingLot;\n            that.iMei = myData.deviceMac;\n            that.price = myData.price;\n            that.priceUnit = myData.priceUnit;\n            that.color = myData.color;\n            that.Odometer = Math.round(myData.currentMileage * 0.0006214);\n            that.make = myData.make;\n            that.lastLocationLat = myData.lastLocationLat;\n            that.modal = myData.model;\n            that.trim = myData.trim;\n            that.engineType = myData.engineType;\n            that.condition = myData.vehicleType;\n            that.stockNumber = myData.stockNumber;\n            that.plateNumber = myData.plate;\n            let _i = that.colorList.findIndex((val) => val === that.color);\n            that.selectedOption = that.colorList[_i];\n            let _j = that.conditionList.findIndex((val) => val === that.condition);\n            that.selectedCondition = that.conditionList[_j];\n            that.lastLocation = myData.lastLocation;\n            that.isOnline = myData.adapter === 'Online' ? 'Online' : 'Offline';\n            myData.lastUpdateTime !== null ? that.lastUpdateTime = getDateString(myData.lastUpdateTime) : that.lastUpdateTime = 'N/A';\n            myData.inventoryTime !== null ? that.inventoryDate = getYMDString(myData.inventoryTime) : '';\n            that.map = {\n                lat: myData.lastLocationLat === null ? 0 : myData.lastLocationLat,\n                lng: myData.lastLocationLng === null ? 0 : myData.lastLocationLng,\n                area: myData.areaCoordinates === null ? [] : myData.areaCoordinates,\n                vehicleInfo: 'info'\n            };\n        });\n    },\n    methods: {\n        showMapTip() {\n            if (this.map.lat || this.map.area.length > 0) {\n                this.showMap = true;\n            }\n        },\n        getFile(event) {//图片上传\n            this.file = event.target.files[0];\n            let formData = new FormData();\n            formData.append(\"file\", this.file); //‘file’是後台接收文件名\n            let config = {\n                headers: {\n                    \"Content-Type\": \"multipart/form-data\"\n                }\n            };\n            let self = this;\n            httpClient.post(\"/api/v1/uploadFile\", formData, config)\n                .then(function (res) {\n                    if (res.data.code === 200) {\n                        let passData = {\n                            title: 'Photo Upload',\n                            show: true,\n                            content: 'Photo Uploaded Successfully',\n                            buttonText: {\n                                btnFirst: '',\n                                btnSecond: 'OK'\n                            }\n                        };\n                        self.closeRemind(passData);\n                    }\n                    self.image = res.data.data.path;\n                }).catch(function (err) {\n                if (err) {\n                    let passData = {\n                        title: 'Photo Upload',\n                        show: true,\n                        content: 'Photo Upload Failed',\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: 'OK'\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            });\n        },\n        saveData() {//设备参数更新，保存\n            let carType = this.selectedCondition;\n            if (carType === 'New') {\n                carType = 1;\n            } else if (carType === 'Used') {\n                carType = 3;\n            } else {\n                carType = 2;\n            }\n\n            function convertDateToTime(strtime) {\n                var date = new Date(strtime);\n                return date.getTime();\n            }\n\n            function isInteger(obj) {\n                return typeof obj === 'number' && obj % 1 === 0\n            }\n\n            let _time = convertDateToTime(this.inventoryDate);\n            let dataTime;\n            if (_time && isInteger(_time)) {\n                dataTime = _time\n            }\n\n            let _data = {\n                color: this.selectedOption,\n                currentMileage: Number(this.Odometer) > 0 ? Number(this.Odometer)* 1609.344 : 0,\n                engineType: this.engineType,\n                id: this.$router.currentRoute.params.id,\n                inventoryTime: dataTime,\n                make: this.make,\n                model: this.modal,\n                photoPath: this.image,\n                plat: this.plateNumber,\n                price: this.price,\n                stockNumber: this.stockNumber,\n                trim: this.trim,\n                vehicleType: carType,\n                year: this.year,\n            };\n\n            let link = \"/api/v1/vehicle/update\";\n            let self = this;\n            httpClient.post(link, _data).then(function (res) {\n                if (res.data.data && res.data.data.result) {\n                    let passData = {\n                        title: 'Vehicle Update',\n                        show: true,\n                        content: 'Success!',\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: 'OK'\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            }).catch(function (err) {\n                if (err) {\n                    let passData = {\n                        title: 'Vehicle Update',\n                        show: true,\n                        content: 'Failed!',\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: 'OK'\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            });\n        },\n        unPairdevice() {//设备解绑，未绑定的设备，按钮不显示\n            let link = '/api/v1/vehicle/unbind/device';\n            let self = this;\n            let data = {\n                deviceMac: this.iMei,\n                vin: this.vin\n            };\n            httpClient.post(link, data).then(function (res) {\n                if (res.data.code === 200) {\n                    let passData = {\n                        title: 'Vehicle Unpair',\n                        show: true,\n                        content: 'Success!',\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: 'OK'\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            }).catch(function (err) {\n                if (err) {\n                    let passData = {\n                        title: 'Vehicle Unpair',\n                        show: true,\n                        content: 'Failed!',\n                        buttonText: {\n                            btnFirst: '',\n                            btnSecond: 'OK'\n                        }\n                    };\n                    self.closeRemind(passData);\n                }\n            });\n        },\n        closeRemind(data) {\n            this.showAlerts.show = data.show;\n            this.showAlerts.title = data.title;\n            this.showAlerts.content = data.content;\n            this.showAlerts.buttonText = data.buttonText;\n        },\n        closeBox() {//子组件来请求父组件关闭弹窗\n            this.showAlerts.show = !this.showAlerts.show;\n        }\n    }\n}\n",null]}