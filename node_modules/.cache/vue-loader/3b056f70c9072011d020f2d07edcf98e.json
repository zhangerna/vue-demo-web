{"remainingRequest":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/bindVehicle.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nonda/nonda/nonda-saas-web/src/views/dashboard/dashboardMain/bindVehicle.vue","mtime":1561517341000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nonda/nonda/nonda-saas-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport httpClient from \"@/utils/httpclient\";\nimport VehicleForm from \"@/components/vehicleForm\";\nimport model from \"@/components/model\";\nexport default {\n    name: \"bindVehicle\",\n    inject: [\"reload\"],\n    components: {\n        VehicleForm,\n        model\n    },\n    data() {\n        return {\n            step1: true,\n            step2: false,\n            step3: false,\n            deviceId: null,\n            step1Button: true,\n            imeiIsVaild: false,\n            imeiSuccess: false,\n            imeiDisable: false,\n            step2Button: true,\n            title: '',\n            data1: {},\n            data2: null,\n            showTip: false,\n            vin: '',\n            vinDisable: false,\n            vinIsVaild: false,\n            vinSuccess: false,\n            isClickStep2: false,\n            vehicleId: '',\n            btnGroup: {btnFirst:'Cancel', btnSecond: 'OK'},\n            content: '',\n            err: false\n        }\n    },\n    watch: {\n        deviceId(newV) {\n            if (newV.length == 15) {\n                this.deviceId = newV;\n                this.imeiDisable = this.err ? false : true;\n                this.imeiIsVaild = false;\n                this.imeiSuccess = true;\n                this.step1Button = false;\n            } else {\n                this.imeiIsVaild = true;\n            }\n        },\n        vin(newV) {\n            if (newV.length == 17) {\n                this.vin = newV;\n                this.vinDisable = true;\n                this.vinIsVaild = false;\n                this.vinSuccess = false;\n                this.step2Button = false;\n                this.clickStep2();\n            } else {\n                this.vinDisable = false;\n                this.vinIsVaild = true;\n\n            }\n        }\n    },\n    mounted() {\n        if (this.$route.query.deviceMac) {\n            this.step1 = false;\n            this.step2 = true;\n            this.deviceId = this.$route.query.deviceMac;\n        }\n    },\n    methods: {\n        closeBox(type){\n            if (type && this.btnGroup.btnSecond == 'Unpair') {\n                this.unbind(this.data1);\n            }\n            if (type && this.btnGroup.status == 'vin') {\n                this.unbind(this.data2);\n            }\n            this.showTip = false;\n        },\n        reloadPage() {\n            window.location.reload();\n        },\n        unbind(data) {\n            httpClient.post('/api/v1/vehicle/unbind/device', {\n                deviceMac: data.deviceMac,\n                vin: data.vin\n            }).then(response => {\n                if (response.data.code == 200) {\n                    if (this.step2) {\n                        window.location.reload();\n                    }\n                    this.vin = '';\n                    this.vinDisable = false;\n                    this.vinIsVaild = false;\n                    this.vinSuccess = false;\n                    this.step2Button = true;\n                    this.showTip = false;\n                    this.step1 = false;\n                    this.step2 = true;\n                } else {\n                    window.location.reload();\n                }\n            })\n        },\n        clickStep2() {\n            httpClient.get('/api/v1/vehicle/detail/vin?vin=' + this.vin, {\n            }).then(response => {\n                this.data2 = response.data.data;\n                this.data2.mac = this.deviceId;\n                if (this.data2.deviceMac == '') {\n                    this.isClickStep2 = true;\n                    this.vinSuccess = false;\n                } else {\n                    this.title = 'Warning';\n                    this.content = `This device is currently paired with Device IMEI:${response.data.data.deviceMac}. Are you sure to unpair the device?`;\n                    this.btnGroup = {btnFirst:'Cancel', btnSecond: 'Unpair', status: 'vin'};\n                    this.showTip = true;\n                    this.vinDisable = false;\n                }\n            }).catch(err => {\n                this.data2 = err.response.data.data;\n                this.title = 'Warning';\n                this.content = `This device is currently paired with Device IMEI:${err.response.data.data.deviceMac}. Are you sure to unpair the device?`;\n                this.btnGroup = {btnFirst:'Cancel', btnSecond: 'Unpair', status: 'vin'};\n                this.showTip = true;\n                this.vinDisable = false;\n            })\n        },\n        showStep3(data) {\n            this.step1 = false;\n            this.step2 = false;\n            this.step3 = true;\n            this.vehicleId = data.vehicleId;\n        },\n        clickStep1() {\n            httpClient.post('/api/v1/device/vehiceldetail/mac', {\n                deviceMac: this.deviceId\n            }).then(response => {\n                this.data1 = response.data.data;\n                if (this.data1.vin == ''){\n                    this.step1 = false;\n                    this.step2 = true;\n                } else {\n                    this.title = 'Warning';\n                    this.content = `This device is currently paired with ${response.data.data.year} ${response.data.data.make} ${response.data.data.model} vin:${response.data.data.vin}`\n                    this.btnGroup = {btnFirst:'Cancel', btnSecond: 'Unpair'};\n                    this.showTip = true;\n                }\n            }).catch(err => {\n                if (!err.response.data.data) {\n                    this.err = true;\n                    this.imeiDisable = false;\n                    this.imeiSuccess = false;\n                    this.title = 'Warning';\n                    this.content = err.response.data.msg;\n                    this.btnGroup = {btnSecond: 'OK'};\n                    this.showTip = true;\n                } else {\n                    this.data1 = err.response.data.data;\n                    if (this.data1.vin == ''){\n                        this.step1 = false;\n                        this.step2 = true;\n                    } else {\n                        this.err = true;\n                        this.imeiDisable = false;\n                        this.imeiSuccess = false;\n                        this.title = 'Warning';\n                        this.content = `This device is currently paired with ${err.response.data.data.year} ${err.response.data.data.make} ${err.response.data.data.model} vin:${err.response.data.data.vin}`\n                        this.btnGroup = {btnFirst:'Cancel', btnSecond: 'Unpair'};\n                        this.showTip = true;\n                    }\n                }\n            })\n        }\n    }\n}\n",null]}